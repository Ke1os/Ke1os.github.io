<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="ke1os"><title>ke1os' blog</title><meta name="description" content="A simple and beautiful blog"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/ke1os.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.1.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a class="current" href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about">About</a></li><li> <a href="/links">Links</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)" style="display:none;"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"><img src="/images/ke1os.png"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/ke1os.png" style="width:220px;" alt="favicon"><h3 title=""><a href="/">ke1os' blog</a></h3><div class="description"><p>A simple and beautiful blog</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/ke1os"><i class="fa fa-github"></i></a></li><li><a href="mailto:3131697620@qq.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY=3131697620"><i class="fa fa-qq"></i></a></li></ul></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> ke1os</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><span>Anatolo </span></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/04/22/diary/April/">April</a></h3></div><div class="post-content"><div class="card"><p><h1 id="Week-1"><a href="#Week-1" class="headerlink" title="Week 1"></a>Week 1</h1><h2 id="2023-x2F-4-x2F-22"><a href="#2023-x2F-4-x2F-22" class="headerlink" title="2023&#x2F;4&#x2F;22"></a>2023&#x2F;4&#x2F;22</h2><p>打算从今天开始,记录自己的学习路程与所思所想.</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-04-22</span><i class="fa fa-tag"></i><a class="tag" href="/tags/diary/" title="diary">diary </a><span class="leancloud_visitors"></span><span>About 26 words, 5 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2022/12/31/2022%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/">2022年度总结</a></h3></div><div class="post-content"><div class="card"><p><p>　　今天是2022年的最后一天，想着还是好好写一个年度报告</p>
<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>非常感谢<a target="_blank" rel="noopener" href="https://www.z1r0.top/">z1r0大师傅</a>能让我接触到CTF与网络空间安全。</p>
<h1 id="学习旅程"><a href="#学习旅程" class="headerlink" title="学习旅程"></a>学习旅程</h1><p>　　也是在1月份的时候，从z1r0师傅那边才知道还有CTF这样的比赛。当初学的方向是逆向，在寒假里面，好好的学了汇编，并且也刷了很多BUU逆向题，学到了很多。然后也跟着队伍一起打了一些比赛，这种在团队中一起努力的感觉很棒。当时就在学逆向和crypto方面，还去学了一段时间滴水的逆向课程(印象最深的就是海哥用汇编的角度讲c语言，画堆栈图)……</p>
<p>　　但是感觉自己以小白的身份学逆向确实有些吃力，之前也从没干过开发。那个时候是五六月份，真的很迷茫，不知道自己下一步干什么，是考研还是就业，是在二进制还是web方面……。于是本着多开拓开拓视野，先好好接触web方面的想法，就去报了一些渗透课程跟着学，去学linux基操，学js，学php，学各种漏洞原理，学各种工具。</p>
<p>　　暑假结束回学校之后，就去学习了更多的web的知识，想当只web狗。10月份中旬，z1r0师傅的实验室下来了，队伍后面就一直在实验室里面学习，花了很多时间来通过ctfshow这个平台的由浅入深地来学习web方向的各个板块，系统的学习了命令执行，php特性，sql注入，xss，nodejs，代码审计等(当然还有很多很多领域没有学习)。每周写周报，每两周写知识分享。在创业园里面跟着大佬们学习，相比自己孤军奋战在宿舍里面学效率高很多，非常感谢z1r0、xiaoxing以及succ3大佬们的的鼓励与帮助orz!!</p>
<p>　　今年是刚刚接触网络安全的第一年，也仅仅只是较广泛的接触了一些方向，并且很多都是跟着感觉走。还是对网络安全方向抱有很多的热情，打算明天花一整年的时间好好复习考研，继续向网络空间安全专业方向靠拢。(自己是数字媒体技术专业的，真可谓是与其”毫不相干”orz)</p>
<h1 id="一些想法"><a href="#一些想法" class="headerlink" title="一些想法"></a>一些想法</h1><ol>
<li>只有心情好，做事才有效率</li>
</ol>
<p>由于去年的一些情感创伤没有处理好，也无法去解决。在今年的整个过程学习中，能一直都被干扰到，消极悲观出现的次数非常多。我也一再地感觉自己得了抑郁，有时候连续几天都是混乱与自闭的状态。我很感激垚垚领先能在我难过的时候和我谈话，感谢z1r0师傅与整个团队的带给我的积极乐观向上的力量，让我能暂时忘掉烦恼。</p>
<ol start="2">
<li><p>不要害怕试错，不要想得太多</p>
</li>
<li><p>收藏家的思维不能有</p>
</li>
</ol>
<p>今年也一直在收藏各种学习资料，但是有些东西放网盘里面，一放就是一辈子……很明显它只在我的网盘里面，没有到我的脑子里。</p>
<ol start="4">
<li>简单的事情多重复</li>
</ol>
<h1 id="明年的展望"><a href="#明年的展望" class="headerlink" title="明年的展望"></a>明年的展望</h1><p>希望我经过一整年的复习，能有个满意的答卷。希望明年的你我都能前程似锦，美梦成真！！！</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-12-31</span><i class="fa fa-tag"></i><a class="tag" href="/tags/年度总结/" title="年度总结">年度总结 </a><span class="leancloud_visitors"></span><span>About 991 words, 3 min 18 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/">nullbook练习</a></h3></div><div class="post-content"><div class="card"><p><h1 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h1><h2 id="babyconst-md5加密"><a href="#babyconst-md5加密" class="headerlink" title="babyconst (md5加密)"></a>babyconst (md5加密)</h2><p>ida分析：</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522170929676.png" class="" title="image-20220522170929676">

<p>用findcrypt查看算法特征码，没有识别</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522170959029.png" class="" title="image-20220522170959029">

<p>跟进sub_40085B函数，发现有md5算法特征码</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522171017689.png" class="" title="image-20220522171017689">

<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522171133194.png" class="" title="image-20220522171133194">

<p>以及md5的加密算法</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522171326494.png" class="" title="image-20220522171326494">

<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522171354381.png" class="" title="image-20220522171354381">

<p>最后对比的也就是unk_603080数组了</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522171416250.png" class="" title="image-20220522171416250">

<p>shift+e提取数组，然后放在pycharm里面替换一下双引号，使十六进制数变成字符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">encode = [ <span class="string">&quot;39&quot;</span>, <span class="string">&quot;6D&quot;</span>, <span class="string">&quot;F0&quot;</span>, <span class="string">&quot;D2&quot;</span>, <span class="string">&quot;42&quot;</span>, <span class="string">&quot;41&quot;</span>, <span class="string">&quot;F8&quot;</span>, <span class="string">&quot;02&quot;</span>, <span class="string">&quot;16&quot;</span>, <span class="string">&quot;7A&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;DC&quot;</span>, <span class="string">&quot;C0&quot;</span>, <span class="string">&quot;D6&quot;</span>, <span class="string">&quot;10&quot;</span>, <span class="string">&quot;6E&quot;</span>, <span class="string">&quot;D3&quot;</span>, <span class="string">&quot;FE&quot;</span>, <span class="string">&quot;68&quot;</span>, <span class="string">&quot;6F&quot;</span>, <span class="string">&quot;27&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;E9&quot;</span>, <span class="string">&quot;00&quot;</span>, <span class="string">&quot;81&quot;</span>, <span class="string">&quot;6B&quot;</span>, <span class="string">&quot;B2&quot;</span>, <span class="string">&quot;B8&quot;</span>, <span class="string">&quot;BC&quot;</span>, <span class="string">&quot;63&quot;</span>, <span class="string">&quot;D7&quot;</span>, <span class="string">&quot;0D&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;40&quot;</span>, <span class="string">&quot;08&quot;</span>, <span class="string">&quot;D2&quot;</span>, <span class="string">&quot;CD&quot;</span>, <span class="string">&quot;B7&quot;</span>, <span class="string">&quot;10&quot;</span>, <span class="string">&quot;60&quot;</span>, <span class="string">&quot;4D&quot;</span>, <span class="string">&quot;69&quot;</span>, <span class="string">&quot;64&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;A8&quot;</span>, <span class="string">&quot;36&quot;</span>, <span class="string">&quot;25&quot;</span>, <span class="string">&quot;54&quot;</span>, <span class="string">&quot;F7&quot;</span>, <span class="string">&quot;DE&quot;</span>, <span class="string">&quot;F0&quot;</span>, <span class="string">&quot;96&quot;</span>, <span class="string">&quot;DF&quot;</span>, <span class="string">&quot;C4&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;F8&quot;</span>, <span class="string">&quot;47&quot;</span>, <span class="string">&quot;AC&quot;</span>, <span class="string">&quot;DE&quot;</span>, <span class="string">&quot;92&quot;</span>, <span class="string">&quot;AC&quot;</span>, <span class="string">&quot;23&quot;</span>, <span class="string">&quot;C4&quot;</span>, <span class="string">&quot;69&quot;</span>, <span class="string">&quot;4B&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;EF&quot;</span>, <span class="string">&quot;32&quot;</span>, <span class="string">&quot;50&quot;</span>, <span class="string">&quot;28&quot;</span>, <span class="string">&quot;46&quot;</span>, <span class="string">&quot;82&quot;</span>, <span class="string">&quot;A2&quot;</span>, <span class="string">&quot;4D&quot;</span>, <span class="string">&quot;59&quot;</span>, <span class="string">&quot;A9&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;8E&quot;</span>, <span class="string">&quot;7A&quot;</span>, <span class="string">&quot;66&quot;</span>, <span class="string">&quot;D8&quot;</span>, <span class="string">&quot;E0&quot;</span>, <span class="string">&quot;D3&quot;</span>, <span class="string">&quot;1F&quot;</span>, <span class="string">&quot;D9&quot;</span>, <span class="string">&quot;BD&quot;</span>, <span class="string">&quot;68&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;46&quot;</span>, <span class="string">&quot;04&quot;</span>, <span class="string">&quot;F6&quot;</span>, <span class="string">&quot;12&quot;</span>, <span class="string">&quot;D8&quot;</span>, <span class="string">&quot;A7&quot;</span>, <span class="string">&quot;1D&quot;</span>, <span class="string">&quot;EB&quot;</span>, <span class="string">&quot;0D&quot;</span>, <span class="string">&quot;FA&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;03&quot;</span>, <span class="string">&quot;5E&quot;</span>, <span class="string">&quot;3F&quot;</span>, <span class="string">&quot;06&quot;</span>, <span class="string">&quot;A5&quot;</span>, <span class="string">&quot;9B&quot;</span>, <span class="string">&quot;99&quot;</span>, <span class="string">&quot;AA&quot;</span>, <span class="string">&quot;58&quot;</span>, <span class="string">&quot;66&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;28&quot;</span>, <span class="string">&quot;D9&quot;</span>, <span class="string">&quot;70&quot;</span>, <span class="string">&quot;72&quot;</span>, <span class="string">&quot;73&quot;</span>, <span class="string">&quot;28&quot;</span>, <span class="string">&quot;6B&quot;</span>, <span class="string">&quot;4C&quot;</span>, <span class="string">&quot;87&quot;</span>, <span class="string">&quot;32&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;DC&quot;</span>, <span class="string">&quot;FF&quot;</span>, <span class="string">&quot;A6&quot;</span>, <span class="string">&quot;C9&quot;</span>, <span class="string">&quot;FE&quot;</span>, <span class="string">&quot;07&quot;</span>, <span class="string">&quot;74&quot;</span>, <span class="string">&quot;20&quot;</span>, <span class="string">&quot;E1&quot;</span>, <span class="string">&quot;DE&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;FD&quot;</span>, <span class="string">&quot;D7&quot;</span>, <span class="string">&quot;C8&quot;</span>, <span class="string">&quot;7B&quot;</span>, <span class="string">&quot;59&quot;</span>, <span class="string">&quot;CD&quot;</span>, <span class="string">&quot;1D&quot;</span>, <span class="string">&quot;73&quot;</span>, <span class="string">&quot;CB&quot;</span>, <span class="string">&quot;7F&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;25&quot;</span>, <span class="string">&quot;22&quot;</span>, <span class="string">&quot;CC&quot;</span>, <span class="string">&quot;3D&quot;</span>, <span class="string">&quot;F2&quot;</span>, <span class="string">&quot;0F&quot;</span>, <span class="string">&quot;F2&quot;</span>, <span class="string">&quot;98&quot;</span>, <span class="string">&quot;7E&quot;</span>, <span class="string">&quot;98&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;42&quot;</span>, <span class="string">&quot;7F&quot;</span>, <span class="string">&quot;05&quot;</span>, <span class="string">&quot;D2&quot;</span>, <span class="string">&quot;BE&quot;</span>, <span class="string">&quot;57&quot;</span>, <span class="string">&quot;03&quot;</span>, <span class="string">&quot;DD&quot;</span>, <span class="string">&quot;22&quot;</span>, <span class="string">&quot;DD&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;C3&quot;</span>, <span class="string">&quot;18&quot;</span>, <span class="string">&quot;EA&quot;</span>, <span class="string">&quot;07&quot;</span>, <span class="string">&quot;24&quot;</span>, <span class="string">&quot;80&quot;</span>, <span class="string">&quot;44&quot;</span>, <span class="string">&quot;D7&quot;</span>, <span class="string">&quot;EC&quot;</span>, <span class="string">&quot;CC&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;FF&quot;</span>, <span class="string">&quot;F5&quot;</span>, <span class="string">&quot;6B&quot;</span>, <span class="string">&quot;C4&quot;</span>, <span class="string">&quot;60&quot;</span>, <span class="string">&quot;70&quot;</span>, <span class="string">&quot;DA&quot;</span>, <span class="string">&quot;E9&quot;</span>, <span class="string">&quot;F9&quot;</span>, <span class="string">&quot;46&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;6C&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;76&quot;</span>, <span class="string">&quot;5D&quot;</span>, <span class="string">&quot;0C&quot;</span>, <span class="string">&quot;21&quot;</span>, <span class="string">&quot;0E&quot;</span>, <span class="string">&quot;49&quot;</span>, <span class="string">&quot;91&quot;</span>, <span class="string">&quot;A0&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;2A&quot;</span>, <span class="string">&quot;04&quot;</span>, <span class="string">&quot;E4&quot;</span>, <span class="string">&quot;21&quot;</span>, <span class="string">&quot;84&quot;</span>, <span class="string">&quot;9F&quot;</span>, <span class="string">&quot;2A&quot;</span>, <span class="string">&quot;B8&quot;</span>, <span class="string">&quot;9B&quot;</span>, <span class="string">&quot;7D&quot;</span>, \</span><br><span class="line">  <span class="string">&quot;9E&quot;</span>, <span class="string">&quot;EA&quot;</span>]</span><br><span class="line">string = <span class="string">&quot;&quot;</span></span><br><span class="line">arr = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encode)):</span><br><span class="line">  string += encode[i]</span><br><span class="line">  <span class="keyword">if</span> (i+<span class="number">1</span>)%<span class="number">16</span> == <span class="number">0</span>:</span><br><span class="line">    arr.append(string.lower())</span><br><span class="line">    string = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(arr)</span><br></pre></td></tr></table></figure>

<p>推荐<a target="_blank" rel="noopener" href="https://pmd5.com/">pmd5网站</a>，cmd5一块一条……</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522171521281.png" class="" title="image-20220522171521281">

<h2 id="babyalgo-RC4加密"><a href="#babyalgo-RC4加密" class="headerlink" title="babyalgo (RC4加密)"></a>babyalgo (RC4加密)</h2><img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522174254718.png" class="" title="image-20220522174254718">

<p>跟进sub_400874加密函数，可以看出加密方法是RC4，”Nu1Lctf233”是密钥</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522174550756.png" class="" title="image-20220522174550756">

<p>在这两个函数中都出现了sub_400646函数，等价于swap()函数</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522174740526.png" class="" title="image-20220522174740526">

<p>写个idapython的脚本，提取出加密后的数组</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">start_addr = <span class="number">0x400925</span></span><br><span class="line">encode = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">44</span>):</span><br><span class="line">    encode.append(idc.get_wide_byte(start_addr+<span class="number">4</span>*i+<span class="number">3</span>))</span><br><span class="line"><span class="built_in">print</span>(encode)</span><br><span class="line"><span class="comment"># [198, 33, 202, 191, 81, 67, 55, 49, 117, 228, 142, 192, 84, 111, 143, 238, 248, 90, 162, 193, 235, 165, 52, 109, 113, 85, 8, 7, 178, 168, 47, 244, 81, 142, 12, 204, 51, 83, 49, 64, 214, 202, 236, 212]</span></span><br></pre></td></tr></table></figure>

<p>刚开始发现出错了，到后面发现，ida里面的v8[39]没有给出……</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522182940444.png" class="" title="image-20220522182940444">

<p>只能猜测，v8[39]的数字，随便带入了个0x40，离答案很近了</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522182449117.png" class="" title="image-20220522182449117">

<p>后面猜测为0，放到cyberchef里面，对了……</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220522183531793.png" class="" title="image-20220522183531793">

<p>下面是写的垃圾脚本……</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">198</span>, <span class="number">33</span>, <span class="number">202</span>, <span class="number">191</span>, <span class="number">81</span>, <span class="number">67</span>, <span class="number">55</span>, <span class="number">49</span>, <span class="number">117</span>, <span class="number">228</span>, <span class="number">142</span>, <span class="number">192</span>, <span class="number">84</span>, <span class="number">111</span>, <span class="number">143</span>, <span class="number">238</span>, <span class="number">248</span>, <span class="number">90</span>, <span class="number">162</span>, <span class="number">193</span>, <span class="number">235</span>, <span class="number">165</span>, <span class="number">52</span>, <span class="number">109</span>, <span class="number">113</span>, <span class="number">85</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">178</span>, <span class="number">168</span>, <span class="number">47</span>, <span class="number">244</span>, <span class="number">81</span>, <span class="number">142</span>, <span class="number">12</span>, <span class="number">204</span>, <span class="number">51</span>, <span class="number">83</span>, <span class="number">49</span>, <span class="number">0</span>, <span class="number">64</span>, <span class="number">214</span>, <span class="number">202</span>, <span class="number">236</span>, <span class="number">212</span>]</span><br><span class="line">h = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> arr:</span><br><span class="line">    h+=(<span class="built_in">hex</span>(i)[<span class="number">2</span>:].rjust(<span class="number">2</span>,<span class="string">&quot;0&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(h)</span><br><span class="line"><span class="comment"># c621cabf5143373175e48ec0546f8feef85aa2c1eba5346d71550807b2a82ff4518e0ccc3353310040d6caecd4</span></span><br><span class="line"><span class="comment"># n1book&#123;us1nG_f3atur3s_7o_de7erm1n3_4lg0ri7hm&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="BabyLib"><a href="#BabyLib" class="headerlink" title="BabyLib"></a>BabyLib</h2><p>65537看起来有点像rsa</p>
<img src="/2022/05/22/BUU-reverse/nullbook%E7%BB%83%E4%B9%A0/image-20220524203235709.png" class="" title="image-20220524203235709">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="comment"># 98422105447041051053864602088923253415180232127076474506079092477911332645192005791731779124677858425580609684921867</span></span><br><span class="line">p = <span class="number">9842210544704105105386460208892325341518023212707647450607909247791133264519200579173177912467785842558060968492186761162106356089009194470097546296829163</span></span><br><span class="line">q = <span class="number">12972360952153818155692381381571252126631475184728971905301445264084096070607651598626783223094292740492828654265391639843199875189333033337169565006624907</span></span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">110694010334901653238216140152683772418101197298114114481381418739511015861349388028360214495059500357527716613334520805339266807313669925649167175211788624655809951516502907329949137499677877779584898365309802983718066683849944838484002656376845311375573423677826690834875095904482448693671735053088583663382</span></span><br><span class="line">d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># n1book&#123;1d3nt1fy_GMp_l1br4ry&#125;</span></span><br></pre></td></tr></table></figure>

</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-05-22</span><i class="fa fa-tag"></i><a class="tag" href="/tags/nullbook/" title="nullbook">nullbook </a><span class="leancloud_visitors"></span><span>About 882 words, 2 min 56 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/">anroid的学习</a></h3></div><div class="post-content"><div class="card"><p><h1 id="frida"><a href="#frida" class="headerlink" title="frida"></a>frida</h1><h2 id="frida的安装"><a href="#frida的安装" class="headerlink" title="frida的安装"></a>frida的安装</h2><h3 id="虚拟环境的安装"><a href="#虚拟环境的安装" class="headerlink" title="虚拟环境的安装"></a>虚拟环境的安装</h3><p>建议在python虚拟环境中安装frida.关于conda虚拟环境，可以看我的<a href="https://ke1os.top/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/#python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83">另一篇博客</a></p>
<p>我将frida环境安装在了python3.8的名为py38虚拟环境中</p>
<h3 id="frida的下载"><a href="#frida的下载" class="headerlink" title="frida的下载"></a>frida的下载</h3><p>以下命令默认是安装最新版的frida。有了虚拟环境，就不会报错了，避免走了很多坑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//启动虚拟环境</span></span><br><span class="line">conda activate py38</span><br><span class="line">    </span><br><span class="line"><span class="comment">//安装frida等</span></span><br><span class="line">pip install frida</span><br><span class="line">pip install frida-tools</span><br></pre></td></tr></table></figure>

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513174331211.png" class="" title="image-20220513174331211">

<h3 id="连接模拟器"><a href="#连接模拟器" class="headerlink" title="连接模拟器"></a>连接模拟器</h3><h4 id="adb连接模拟器"><a href="#adb连接模拟器" class="headerlink" title="adb连接模拟器"></a>adb连接模拟器</h4><p>本人使用的模拟器为夜神模拟器（不同模拟器使用的端口都是不一致的，可以自行百度)</p>
<p>在命令提示符界面中键入命令：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb connect <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">62001</span></span><br><span class="line"><span class="comment">//adb disconnect 为取消链接</span></span><br></pre></td></tr></table></figure>

<p>然后再输入命令：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb devices</span><br></pre></td></tr></table></figure>

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513173210154.png" class="" title="image-20220513173210154">

<p>使用以下命令查看模拟器cpu架构，先记一下，后面需要根据此来下载对应的frida-server</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getprop ro.product.cpu.abi</span><br></pre></td></tr></table></figure>

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513180231504.png" class="" title="image-20220513180231504">

<h4 id="frida-server的下载与使用"><a href="#frida-server的下载与使用" class="headerlink" title="frida-server的下载与使用"></a>frida-server的下载与使用</h4><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1610276">参考博客</a></p>
<p>查看pip安装目录</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="built_in">list</span></span><br></pre></td></tr></table></figure>

<p>查看frida的版本</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513173906148.png" class="" title="image-20220513173906148">

<p><a target="_blank" rel="noopener" href="https://github.com/frida/frida/releases">下载地址</a>，选择firda对应版本以及模拟器的cpu架构下载。经过几次测试，发现适合本机模拟器的是以下的版本</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513200322639.png" class="" title="image-20220513200322639">

<p>我的frida-server文件再E:\Anroid目录下，使用adb将frida-server文件push到模拟器的data&#x2F;local&#x2F;tmp目录下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push E:\Anroid\frida-server<span class="number">-15.1</span><span class="number">.22</span>-android-x86 data/local/tmp</span><br></pre></td></tr></table></figure>

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513193910996.png" class="" title="image-20220513193910996">



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">cd data/local/tmp</span><br><span class="line">chmod <span class="number">777</span> frida-server<span class="number">-15.1</span><span class="number">.22</span>-android-x86</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行文件</span></span><br><span class="line">./frida-server<span class="number">-15.1</span><span class="number">.22</span>-android-x86</span><br><span class="line"><span class="comment">//如果运行失败，则需要更换版本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//进行端口转发</span></span><br><span class="line">adb forward tcp:<span class="number">27042</span> tcp:<span class="number">27042</span></span><br><span class="line">adb forward tcp:<span class="number">27043</span> tcp:<span class="number">27043</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//查看 Android 进程列表</span></span><br><span class="line">frida-ps -R</span><br></pre></td></tr></table></figure>

<p>运行之后，在另一个窗口输入以下命令，进行端口转发</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:<span class="number">27042</span> tcp:<span class="number">27042</span></span><br></pre></td></tr></table></figure>

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513195414339.png" class="" title="image-20220513195414339">



<h2 id="frida的基本使用"><a href="#frida的基本使用" class="headerlink" title="frida的基本使用"></a>frida的基本使用</h2><p>pass</p>
<h1 id="XCTF-anroid-新手区刷题记录"><a href="#XCTF-anroid-新手区刷题记录" class="headerlink" title="XCTF anroid 新手区刷题记录"></a>XCTF anroid 新手区刷题记录</h1><h2 id="easyjava"><a href="#easyjava" class="headerlink" title="easyjava"></a>easyjava</h2><h2 id="app1"><a href="#app1" class="headerlink" title="app1"></a>app1</h2><p>用jadx-gui查看</p>
<p>onClick中可以看到主要的对比函数，是异或运算</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513224842508.png" class="" title="image-20220513224842508">

<p>双击上面的APPLICATION_ID可以跳转到这里</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513224855584.png" class="" title="image-20220513224855584">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">version_code = <span class="number">15</span></span><br><span class="line">version_name = <span class="string">&quot;X&lt;cP[?PHNB&lt;P?aj&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(version_name)):</span><br><span class="line">    flag+=<span class="built_in">chr</span>(version_code^<span class="built_in">ord</span>(version_name[i]))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># W3l_T0_GAM3_0ne</span></span><br></pre></td></tr></table></figure>

<h2 id="app2"><a href="#app2" class="headerlink" title="app2"></a>app2</h2><p>（说实话真不太熟悉java，代码审计的功底基本为0……orz）</p>
<p>可以看到这边有个SecondActivity函数</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513225227328.png" class="" title="image-20220513225227328">

<p>仔细阅读代码，此处应该是stringExtra和stringExtra2字符串经过连接，加密之后需要和左边的字符串相等，继续跟进</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513225417546.png" class="" title="image-20220513225417546">

<h3 id="分析so文件"><a href="#分析so文件" class="headerlink" title="分析so文件"></a>分析so文件</h3><p>loadLibrary()函数，载入外部的模块，有了之前的教训，可以知道so文件放在lib目录下</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513225621454.png" class="" title="image-20220513225621454">

<p>在cmd环境中使用apktool解包apk文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d app2.apk</span><br></pre></td></tr></table></figure>

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513230045870.png" class="" title="image-20220513230045870">

<p>奇怪，lib目录下有三个文件夹，里面有三个同名的so文件……</p>
<p>大同小异，我用ida反汇编第二个文件夹中的so文件，可以看到其中的加密函数</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513230112449.png" class="" title="image-20220513230112449">

<p>可以从函数名称中得知是AES加密，key是”thisisatestkey&#x3D;&#x3D;”</p>
<p>通过神器cyberchef，可以解密出来（试了好久……）</p>
<img src="/2022/05/13/mobile/anroid%EF%BF%BDf%60/UQ7JXFRR%25Q39G_ME%60DDOSFU.png" class="" title="img">

<p>以为账号试aimage，密码是tencent，就会弹出flag，是我太年轻了……</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513230509901.png" class="" title="image-20220513230509901">

<p>再回jadx-gui中查看</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513230646078.png" class="" title="image-20220513230646078">

<p>这边也有和上面一样加密的字符串，cyberchef解密</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513230838345.png" class="" title="image-20220513230838345">

<p>服了……没想到解出来的就是flag，看来题目就没想过会弹出flag，有点反常规</p>
<h2 id="app3"><a href="#app3" class="headerlink" title="app3"></a>app3</h2><p>题目就给出了一个.ab文件，使用010查看一下文件头</p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-257715.htm">看雪大佬博客</a>中说，这边是none，说明是没有加密的意思</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513231311376.png" class="" title="image-20220513231311376">

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513231458140.png" class="" title="image-20220513231458140">

<h3 id="转换ab文件"><a href="#转换ab文件" class="headerlink" title="转换ab文件"></a>转换ab文件</h3><p>这边使用的是github上的abe工具来将.ab文件转换成jar文件</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513232130525.png" class="" title="image-20220513232130525">

<p>下载之后，我将abe.jar和app3.ab放在了同一个文件夹中，运行以下命令：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar abe.jar unpack  app3.ab app3.tar</span><br></pre></td></tr></table></figure>

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513231844242.png" class="" width="1">

<p>解压之后可以看到文件中的apk文件，在模拟器中安装</p>
<p>在同目录下，还有一个db文件中，其中有个Demo.db文件</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513232535257.png" class="" title="image-20220513232535257">

<p>使用sqlitebrowser打开Demo.db文件</p>
<p>打开之后发现需要密码</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513232928575.png" class="" title="image-20220513232928575">

<p>用jadx-gui分析base.apk文件，貌似中间就是关键的加密函数了</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513233324594.png" class="" title="image-20220513233324594">

<p>说实话这边很绕，需要改类名和方法名</p>
<p>class1和class2的定义：</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513233826151.png" class="" title="image-20220513233826151">

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513233848734.png" class="" title="image-20220513233848734">

<p>调用：</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513234007698.png" class="" title="image-20220513234007698">

<p>“Stra1234”（”Stranger”字符串和”123456”各取前四位）md5加密之后，与字符串”Stra1234”和”yaphetshan”(注意方法class1_fun3)结合，也就是”Stra123444e2e4457d4e252ca5b9fe9d20b3fea5yaphetshan”进行SHA-1加密</p>
<p>下面是伪代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sha1(<span class="string">&quot;Stra1234&quot;</span> + md5(<span class="string">&quot;Stra1234&quot;</span>) + <span class="string">&quot;yaphetshan&quot;</span>)[<span class="number">0</span>:<span class="number">7</span>]</span><br></pre></td></tr></table></figure>

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220513235429003.png" class="" title="image-20220513235429003">

<p>“ae56f99”</p>
<p>当然也可以用<a target="_blank" rel="noopener" href="https://chan-shaw.github.io/2020/04/09/xctf-writeup-app3/">python</a>、java实现，Java我不是很熟悉，看的我一愣一愣的……</p>
<h3 id="sqlitebrowser打开-db文件"><a href="#sqlitebrowser打开-db文件" class="headerlink" title="sqlitebrowser打开.db文件"></a>sqlitebrowser打开.db文件</h3><img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220514000120678.png" class="" title="image-20220514000120678">

<p>打开后：</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220514000211309.png" class="" title="image-20220514000211309">

<p>很奇怪，是不是我没有执行apk，没有进行下面的语句执行，所有flag没有生成？？</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220514000248745.png" class="" title="image-20220514000248745">



<h2 id="easy-dex"><a href="#easy-dex" class="headerlink" title="easy-dex"></a>easy-dex</h2><p>这一题真的是见世面了……</p>
<p>hasCode &#x3D; false ， name &#x3D; Nativeactivity</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220516224951427.png" class="" title="image-20220516224951427">

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220516224556925.png" class="" title="image-20220516224556925">

<p>看大佬博客说，入口点在so文件中的anroid_main函数中</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220516225048312.png" class="" title="image-20220516225048312">

<p>可以看到程序的主逻辑了，当摇动手机到100次的时候，就会生成真正的dex文件，然后删除，我们需要根据它的加密方法，换源dex文件</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220516225313486.png" class="" title="image-20220516225313486">

<p>先把off_43A18数据dump出来</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220516225531707.png" class="" title="image-20220516225531707">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line">start_address=<span class="number">0x7004</span></span><br><span class="line">data_length=<span class="number">0x3ca10</span></span><br><span class="line">data=idaapi.get_bytes(start_address, data_length)</span><br><span class="line">fp = <span class="built_in">open</span>(<span class="string">&#x27;dump&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">fp.write(data)</span><br><span class="line">fp.close()</span><br></pre></td></tr></table></figure>

<p>dump出来，然后把加密形式用python实现，<a target="_blank" rel="noopener" href="https://www.cnblogs.com/S1mba/p/13489979.html">代码来源</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dump&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = <span class="built_in">list</span>(f.read())</span><br><span class="line">    size = <span class="number">0x3ca10</span></span><br><span class="line">    times = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> times &lt;= <span class="number">0x59</span>:</span><br><span class="line">            t = <span class="built_in">int</span>(times / <span class="number">10</span>)</span><br><span class="line">            <span class="keyword">if</span> times % <span class="number">10</span> == <span class="number">9</span>:</span><br><span class="line">                s = <span class="built_in">int</span>(size / <span class="number">10</span>)</span><br><span class="line">                x = (t + <span class="number">1</span>) * s</span><br><span class="line">                <span class="keyword">if</span> s * t &lt; x:</span><br><span class="line">                    c = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(s):</span><br><span class="line">                        data[s * t + c] = data[s * t + c] ^ times</span><br><span class="line">                        c += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> times == <span class="number">0x59</span>:</span><br><span class="line">                    <span class="keyword">while</span> x &lt; size:</span><br><span class="line">                        data[x] = data[x] ^ <span class="number">89</span></span><br><span class="line">                        x += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        times += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">fbytes = <span class="built_in">bytes</span>(data)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;easydex.dex&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f1:</span><br><span class="line">    f1.write(zlib.decompress(fbytes))</span><br></pre></td></tr></table></figure>

<p>生成的easydex.dex文件用jadx-gui打开</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220516230011785.png" class="" title="image-20220516230011785">

<p>在原apk文件中找到了two_fish字符，可以推断是two_fish加密了</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220516225741937.png" class="" title="image-20220516225741937">

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I have a male fish and a female fish.</span><br></pre></td></tr></table></figure>

<p>网上的twofish加密是base64解密的,所以我们把easydex.dex中的数组先用base64加密一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">flag = [-<span class="number">120</span>, <span class="number">77</span>, -<span class="number">14</span>, -<span class="number">38</span>, <span class="number">17</span>, <span class="number">5</span>, -<span class="number">42</span>, <span class="number">44</span>, -<span class="number">32</span>, <span class="number">109</span>, <span class="number">85</span>, <span class="number">31</span>, <span class="number">24</span>, -<span class="number">91</span>, -<span class="number">112</span>, -<span class="number">83</span>, <span class="number">64</span>, -<span class="number">83</span>, -<span class="number">128</span>, <span class="number">84</span>, <span class="number">5</span>, -<span class="number">94</span>, -<span class="number">98</span>, -<span class="number">30</span>, <span class="number">18</span>, <span class="number">70</span>, -<span class="number">26</span>, <span class="number">71</span>, <span class="number">5</span>, -<span class="number">99</span>, -<span class="number">62</span>, -<span class="number">58</span>, <span class="number">117</span>, <span class="number">29</span>, -<span class="number">44</span>, <span class="number">6</span>, <span class="number">112</span>, -<span class="number">4</span>, <span class="number">81</span>, <span class="number">84</span>, <span class="number">9</span>, <span class="number">22</span>, -<span class="number">51</span>, <span class="number">95</span>, -<span class="number">34</span>, <span class="number">12</span>, <span class="number">47</span>, <span class="number">77</span>]</span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    data.append(i&amp;<span class="number">0xff</span>)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(<span class="built_in">bytes</span>(data)))</span><br><span class="line"><span class="comment"># iE3y2hEF1izgbVUfGKWQrUCtgFQFop7iEkbmRwWdwsZ1HdQGcPxRVAkWzV/eDC9N</span></span><br></pre></td></tr></table></figure>

<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220516230606406.png" class="" title="image-20220516230606406">

<p>qwb{TH3y_Io&lt;e_EACh_OTh3r_FOrEUER}</p>
<p>哪里easy啊……  ｡ﾟヽ(ﾟ´Д&#96;)ﾉﾟ｡</p>
<h2 id="easy-so"><a href="#easy-so" class="headerlink" title="easy-so"></a>easy-so</h2><p>用jadx-gui打开，发现加载了so文件，但是发现没有在jadx-gui中发现lib文件夹，把我一慌……</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517112946196.png" class="" title="image-20220517112946196">

<p>好吧是我瞎了……</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517113337761.png" class="" title="image-20220517113337761">

<p>还是用老套路,用apktool</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d easy-so.apk</span><br></pre></td></tr></table></figure>

<p>去lib文件夹下，然后用ida分析一下so文件：</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517113130305.png" class="" title="image-20220517113130305">

<p>在这边就很清晰了，上脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">string = <span class="string">&quot;f72c5a36569418a20907b55be5bf95ad&quot;</span></span><br><span class="line">string1 = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(string),<span class="number">2</span>):</span><br><span class="line">    string1 += string[i+<span class="number">1</span>]</span><br><span class="line">    string1 += string[i]</span><br><span class="line"><span class="built_in">print</span>(string1[<span class="number">16</span>:]+string1[:<span class="number">16</span>])</span><br><span class="line"><span class="comment"># 90705bb55efb59da7fc2a5636549812a</span></span><br></pre></td></tr></table></figure>

<p>flag{90705bb55efb59da7fc2a5636549812a}</p>
<h2 id="基础anroid"><a href="#基础anroid" class="headerlink" title="基础anroid"></a>基础anroid</h2><p>有点非预期解的感觉……</p>
<p>用jadx-gui打开之后，发现有压缩包，然后貌似和jpg有关</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517192643812.png" class="" title="image-20220517192643812">

<p>apktool解包之后，找到这个压缩包，把后缀改成jpg，打开</p>
<p>我这个做法还是挺拉跨的，如果对齐进行了混淆，那就……</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517192330048.png" class="" title="image-20220517192330048">

<p>看wp之后，发现了一般的做法：</p>
<p>MainAcitvity中有个checkPassword，跟进函数</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517193129590.png" class="" title="image-20220517193129590">

<p>我用的是爆破：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">chr</span>(<span class="number">255</span> - <span class="built_in">len</span> - <span class="number">100</span> - t) == <span class="string">&#x27;0&#x27;</span> :</span><br><span class="line">            flag += <span class="built_in">chr</span>(t)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># kjihgfedcba`</span></span><br></pre></td></tr></table></figure>

<p>输入之后，发现还没有完……</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517193549536.png" class="" title="image-20220517193549536">

<p>验证成功后就到了MainActivity2，发送了一个广播</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517195713221.png" class="" title="image-20220517195713221">

<p>接受广播器只有一个，接着会启动NextContent这个活动</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517195855213.png" class="" title="image-20220517195855213">

<p>跟进函数功能就是读取timg_2.zip的内容，然后输入到img.jpg中</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517200425615.png" class="" title="image-20220517200425615">

<p>androidminifest中有广播内容，也就是”android.is.very.fun”</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517193727683.png" class="" title="image-20220517193727683">

<p>出来了！！！</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517200651313.png" class="" title="image-20220517200651313">



<h2 id="anroid-2-0"><a href="#anroid-2-0" class="headerlink" title="anroid 2.0"></a>anroid 2.0</h2><p>用jadx-gui打开</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517205934836.png" class="" title="image-20220517205934836">

<p>还是熟悉的套路，用apktool解包apk之后，在lib文件加下，找到so文件</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517210002295.png" class="" title="image-20220517210002295">

<p>用ida分析</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517205901311.png" class="" title="image-20220517205901311">

<p>注意这边有坑点， i!&#x3D;4，也就是i&lt;4，只对前4位进行了运算</p>
<p>查看Init（）函数，大概就是把15位的字符串，分成了三份</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517203727232.png" class="" title="image-20220517203727232">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">v5 = []</span><br><span class="line">c5 = <span class="string">&quot;LN^dl&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c5)-<span class="number">1</span>):</span><br><span class="line">        v5.append((<span class="built_in">ord</span>(c5[i])^<span class="number">0x80</span>)//<span class="number">2</span>)</span><br><span class="line">v5.append(<span class="built_in">ord</span>(c5[<span class="number">4</span>]))</span><br><span class="line"><span class="comment"># print(v5)</span></span><br><span class="line"></span><br><span class="line">c6 = [<span class="number">32</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">22</span>, <span class="number">97</span>]</span><br><span class="line">v6 = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c6)-<span class="number">1</span>):</span><br><span class="line">    v6.append(c6[i]^<span class="built_in">ord</span>(c5[i]))</span><br><span class="line">v6.append(c6[<span class="number">4</span>])</span><br><span class="line"><span class="comment"># print(v6)</span></span><br><span class="line"></span><br><span class="line">c7 = <span class="string">&quot;AFBo&#125;&quot;</span></span><br><span class="line">v7 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c7)-<span class="number">1</span>):</span><br><span class="line">    v7.append(<span class="built_in">ord</span>(c7[i])^c6[i])</span><br><span class="line">v7.append(<span class="built_in">ord</span>(c7[<span class="number">4</span>]))</span><br><span class="line"><span class="comment"># print(v7)</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    flag += <span class="built_in">chr</span>(v5[i]) + <span class="built_in">chr</span>(v6[i]) + <span class="built_in">chr</span>(v7[i])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<h2 id="APK逆向"><a href="#APK逆向" class="headerlink" title="APK逆向"></a>APK逆向</h2><p>题目的意思还是不难理解的，将字符串”Tenshine”md5加密之后，每两位取第一位字符</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517232125177.png" class="" title="image-20220517232125177">

<p>用cmd5网站加密的时候，看成下面的m5_middle了，纠结了挺久……</p>
<img src="/2022/05/13/mobile/anroid%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220517232310890.png" class="" title="image-20220517232310890">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;Tenshine&#x27;</span></span><br><span class="line"></span><br><span class="line">hl = hashlib.md5()</span><br><span class="line"></span><br><span class="line">hl.update(<span class="built_in">str</span>.encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&quot;%s&quot; MD5加密后为 ：&#x27;</span>%<span class="built_in">str</span> + hl.hexdigest())</span><br><span class="line"></span><br><span class="line">string = hl.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(string)):</span><br><span class="line">    <span class="keyword">if</span> i%<span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(string[i],end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment"># bc72f242a6af3857</span></span><br></pre></td></tr></table></figure>

</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-05-13</span><i class="fa fa-tag"></i><a class="tag" href="/tags/anroid/" title="anroid">anroid </a><span class="leancloud_visitors"></span><span>About 2294 words, 7 min 38 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2022/05/10/CTF/2022catf1agctf/">2022catf1agctf</a></h3></div><div class="post-content"><div class="card"><p><span id="more"></span>

<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="怎么会多一个呢"><a href="#怎么会多一个呢" class="headerlink" title="怎么会多一个呢"></a>怎么会多一个呢</h2><p><a target="_blank" rel="noopener" href="http://www.factordb.com/">在线网站</a>分解出来三个素数，和普通rsa解题一致</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> number</span><br><span class="line">n=<span class="number">73551482761993440116378276402850976017673970117685879384712768054097267028974244867004238587658366463106703581107613883463180833706377915593443986550610497954246664378469651</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">2492374307</span></span><br><span class="line">q = <span class="number">4254843227</span></span><br><span class="line">t = <span class="number">6935768738605665705725288400892432256194550668863095515013942769049162888322407038880737120756913240675144540329112141837524407303580284917764285456453059</span></span><br><span class="line">d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(t-<span class="number">1</span>))</span><br><span class="line">c = <span class="number">19088340804936031145050310701046663800140062626102387290922890724239533128878474005542684734507475562997222905703018409354867816494925059525377106444000231776165581716296665</span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(number.long_to_bytes(m))</span><br><span class="line"><span class="comment"># catf1ag&#123;5a1dbe0e-c6bc-11ec-9ffe-e8d8d18b16eb&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="高实在是高"><a href="#高实在是高" class="headerlink" title="高实在是高"></a>高实在是高</h2><p>我看到题的时候发现e非常的小，就直接套低加密指数攻击那一套了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> number</span><br><span class="line">n=<span class="number">12665183429254325580945372911206360706257079006954643947743121664454914089524916634832685040737214233687785325112424576039016165508146660290974828802710996880849185068704144690143915135774197938764858051298755021664568772363301699454954045374224914126975984844824184263131757665633324767483926757913457691303836308728657455890530401047029807132954324528617558308552469993676230342998368641468028935159530808062712526662606628371783359397956992056631816818089093174030024770769185589578769480295675152580623898653766068001693142399972844934629828827684074705324777912603273764730083438485014417283937379823019721736119</span></span><br><span class="line">e=<span class="number">3</span></span><br><span class="line">c=<span class="number">757846665709612710047622798901607696475966191486157677993807167873384365513676489731461790205050172225086169489914035089956311182880536480621453222154862896612205436092262339764782754486059223792491004753337631375452744373859969281558865685434771438386779285599911963081936786091339632323042550461240292308997539607661877861</span></span><br><span class="line">high_m=<span class="number">911717829801678618100911351591485103708233783320853921932061644898078088242070960582223500287266227352502272</span></span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    res=iroot(c+k*n,e)</span><br><span class="line">    <span class="keyword">if</span>(res[<span class="number">1</span>]==<span class="literal">True</span>):</span><br><span class="line">        <span class="built_in">print</span>(number.long_to_bytes(res[<span class="number">0</span>]))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    k=k+<span class="number">1</span></span><br><span class="line"><span class="comment"># catf1ag&#123;852a6546-9d42-4b42-bcd6-73c7f4327627&#125;</span></span><br></pre></td></tr></table></figure>

<p>赛后看<a target="_blank" rel="noopener" href="https://blog.csdn.net/zzq487782568/article/details/124686138?spm=1001.2014.3001.5502">z1r0大师傅wp</a>才发现是rsa中的已知明文m题型，看来rsa题还是得刷(orz)</p>
<p>用sage<a target="_blank" rel="noopener" href="https://sagecell.sagemath.org/">在线环境</a>可以解出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hexStr_to_str</span>(<span class="params">hex_str</span>):</span><br><span class="line">    <span class="built_in">hex</span> = hex_str.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    str_bin = binascii.unhexlify(<span class="built_in">hex</span>)</span><br><span class="line">    <span class="keyword">return</span> str_bin.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">phase2</span>(<span class="params">high_m, n, c</span>):</span><br><span class="line">    R.&lt;x&gt; = PolynomialRing(Zmod(n), implementation=<span class="string">&#x27;NTL&#x27;</span>)</span><br><span class="line">    m = high_m + x</span><br><span class="line">    M = m((m^<span class="number">3</span> - c).small_roots()[<span class="number">0</span>])</span><br><span class="line">    <span class="built_in">print</span>(hexStr_to_str(<span class="built_in">hex</span>(<span class="built_in">int</span>(M))[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line">n=<span class="number">12665183429254325580945372911206360706257079006954643947743121664454914089524916634832685040737214233687785325112424576039016165508146660290974828802710996880849185068704144690143915135774197938764858051298755021664568772363301699454954045374224914126975984844824184263131757665633324767483926757913457691303836308728657455890530401047029807132954324528617558308552469993676230342998368641468028935159530808062712526662606628371783359397956992056631816818089093174030024770769185589578769480295675152580623898653766068001693142399972844934629828827684074705324777912603273764730083438485014417283937379823019721736119</span></span><br><span class="line">e=<span class="number">3</span></span><br><span class="line">c=<span class="number">757846665709612710047622798901607696475966191486157677993807167873384365513676489731461790205050172225086169489914035089956311182880536480621453222154862896612205436092262339764782754486059223792491004753337631375452744373859969281558865685434771438386779285599911963081936786091339632323042550461240292308997539607661877861</span></span><br><span class="line">high_m=<span class="number">911717829801678618100911351591485103708233783320853921932061644898078088242070960582223500287266227352502272</span></span><br><span class="line"></span><br><span class="line">phase2(high_m, n, c)</span><br><span class="line"><span class="comment"># catf1ag&#123;852a6546-9d42-4b42-bcd6-73c7f4327627&#125;	</span></span><br></pre></td></tr></table></figure>

<p>我这边就安装了一下sage环境，在<a target="_blank" rel="noopener" href="https://github.com/sagemath/sage-windows/releases">github上下载</a>完成后，双击安装包即可，可以多看看<a target="_blank" rel="noopener" href="https://www.osgeo.cn/sagemath/tutorial/programming.html#section-standalone">sage中文文档</a></p>
<h3 id="sage的使用"><a href="#sage的使用" class="headerlink" title="sage的使用"></a>sage的使用</h3><p>load()和attach()两种方法皆可，attach()会根据sage文件的修改加载，比较推荐</p>
<img src="/2022/05/10/CTF/2022catf1agctf/image-20220510185557247.png" class="" title="image-20220510185557247">

<img src="/2022/05/10/CTF/2022catf1agctf/image-20220510185513564.png" class="" title="image-20220510185513564">

<h2 id="栓q"><a href="#栓q" class="headerlink" title="栓q"></a>栓q</h2><p>通过<a target="_blank" rel="noopener" href="https://blog.csdn.net/GeoJava/article/details/7740191">这篇博客</a>可以知道短信息的内容部分使用的是unicode编码</p>
<img src="/2022/05/10/CTF/2022catf1agctf/image-20220510171102059.png" class="" title="image-20220510171102059">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">string = [<span class="number">0x771F</span> ,<span class="number">0x7684</span> ,<span class="number">0x662F</span> ,<span class="number">0x6813</span> ,<span class="number">0x0051</span> ,<span class="number">0x7ED9</span> ,<span class="number">0x4F60</span> ,<span class="number">0x0066</span> ,<span class="number">0x006C</span> ,<span class="number">0x0061</span>,<span class="number">0x0067</span>,<span class="number">0xFF1A</span>,<span class="number">0x0063</span>,<span class="number">0x0061</span>,<span class="number">0x0074</span>,<span class="number">0x0066</span>,<span class="number">0x0031</span>,<span class="number">0x0061</span>,<span class="number">0x0067</span>,<span class="number">0x007B</span>,\</span><br><span class="line"><span class="number">0x0066</span>,<span class="number">0x0034</span>,<span class="number">0x0065</span>,<span class="number">0x0066</span>,<span class="number">0x0037</span>,<span class="number">0x0064</span>,<span class="number">0x0064</span>,<span class="number">0x0036</span>,<span class="number">0x002D</span>,<span class="number">0x0063</span>,<span class="number">0x0064</span>,<span class="number">0x0061</span>,<span class="number">0x0031</span>,<span class="number">0x002D</span>,<span class="number">0x0031</span>,<span class="number">0x0031</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i),end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment"># 真的是栓Q给你flag：catf1ag&#123;f4ef7dd6-cda1-11</span></span><br></pre></td></tr></table></figure>

<p>但是只发现了一半的flag</p>
<img src="/2022/05/10/CTF/2022catf1agctf/image-20220510170511956.png" class="" title="image-20220510170511956">

<p>原来是零宽度字符隐写……放上<a target="_blank" rel="noopener" href="https://lazzzaro.github.io/2020/05/24/misc-%E9%9B%B6%E5%AE%BD%E5%BA%A6%E5%AD%97%E7%AC%A6%E9%9A%90%E5%86%99/">大佬总结的文章</a></p>
<p>在线网站：<a target="_blank" rel="noopener" href="http://330k.github.io/misc_tools/unicode_steganography.html">http://330k.github.io/misc_tools/unicode_steganography.html</a></p>
<img src="/2022/05/10/CTF/2022catf1agctf/image-20220510172257864.png" class="" title="image-20220510172257864">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># catf1ag&#123;f4ef7dd6-cda1-11ec-860b-2cf05d95545&#125;</span></span><br></pre></td></tr></table></figure>

<p>怕是我少见多怪了（orz）</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-05-10</span><i class="fa fa-tag"></i><a class="tag" href="/tags/CTF复现/" title="CTF复现">CTF复现 </a><span class="leancloud_visitors"></span><span>About 505 words, 1 min 41 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2022/05/08/CTF/2022angstromctf/">2022angstromctf</a></h3></div><div class="post-content"><div class="card"><p><span id="more"></span>

<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="复现-Vinegar-Factory"><a href="#复现-Vinegar-Factory" class="headerlink" title="[复现]Vinegar Factory"></a>[复现]Vinegar Factory</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">alpha = string.ascii_lowercase</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, key</span>):</span><br><span class="line">    ret = <span class="string">&quot;&quot;</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> msg:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> alpha:</span><br><span class="line">            ret += alpha[(alpha.index(key[i]) + alpha.index(c)) % <span class="built_in">len</span>(alpha)]</span><br><span class="line">            i = (i + <span class="number">1</span>) % <span class="built_in">len</span>(key)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret += c</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">inner = alpha + <span class="string">&quot;_&quot;</span></span><br><span class="line">noise = inner + <span class="string">&quot;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the vinegar factory! Solve some crypto, it&#x27;ll be fun I swear!&quot;</span>)</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">50</span> == <span class="number">49</span>:</span><br><span class="line">        fleg = flag</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        fleg = <span class="string">&quot;actf&#123;&quot;</span> + <span class="string">&quot;&quot;</span>.join(random.choices(inner, k=random.randint(<span class="number">10</span>, <span class="number">50</span>))) + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    start = <span class="string">&quot;&quot;</span>.join(random.choices(noise, k=random.randint(<span class="number">0</span>, <span class="number">2000</span>)))</span><br><span class="line">    end = <span class="string">&quot;&quot;</span>.join(random.choices(noise, k=random.randint(<span class="number">0</span>, <span class="number">2000</span>)))</span><br><span class="line">    key = <span class="string">&quot;&quot;</span>.join(random.choices(alpha, k=<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Challenge <span class="subst">&#123;i&#125;</span>: <span class="subst">&#123;start&#125;</span><span class="subst">&#123;encrypt(fleg + <span class="string">&#x27;fleg&#x27;</span>, key)&#125;</span><span class="subst">&#123;end&#125;</span>&quot;</span>)</span><br><span class="line">    x = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> x != fleg:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Nope! Better luck next time!&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>题目的意思是远端随机产生一个fleg，其被actf{}括起来，以及一个key，用key加密fleg+”fleg”字符串，并且将其仍到上千个字符中，并且服务端会在未输入的20秒之内关闭，在循环次数为50次的时候会将真正的flag放到noise字符串中。</p>
<img src="/2022/05/08/CTF/2022angstromctf/image-20220508113827348.png" class="" title="image-20220508113827348">

<p><a target="_blank" rel="noopener" href="https://ctftime.org/writeup/33668">代码参考</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">alphabet = string.ascii_lowercase</span><br><span class="line"></span><br><span class="line">s = remote(<span class="string">&quot;challs.actf.co&quot;</span>,<span class="number">31333</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> count <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">51</span>):</span><br><span class="line">    s.recvuntil(<span class="string">&quot;Challenge&quot;</span>)</span><br><span class="line">    noise = <span class="built_in">str</span>(s.recvuntil(<span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(noise)</span><br><span class="line"></span><br><span class="line">    output_file = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line">    length = <span class="built_in">len</span>(noise)</span><br><span class="line">    <span class="built_in">print</span>(length)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, length - <span class="number">50</span>):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果连续四个字符是字母</span></span><br><span class="line">        <span class="keyword">if</span> noise[i] <span class="keyword">in</span> alphabet <span class="keyword">and</span> noise[i + <span class="number">1</span>] <span class="keyword">in</span> alphabet <span class="keyword">and</span> noise[i + <span class="number">2</span>] <span class="keyword">in</span> alphabet <span class="keyword">and</span> noise[i + <span class="number">3</span>] <span class="keyword">in</span> alphabet:</span><br><span class="line">            <span class="keyword">if</span> noise[i + <span class="number">4</span>] == <span class="string">&#x27;&#123;&#x27;</span>:   <span class="comment"># 并且第五个是&quot;&#123;&quot;</span></span><br><span class="line">                a = noise[i:i + <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 开始往后循环，碰到&quot;&#123;&quot;就停止，</span></span><br><span class="line">                <span class="keyword">while</span> noise[i + <span class="number">5</span>] != <span class="string">&#x27;&#125;&#x27;</span> <span class="keyword">and</span> noise[i + <span class="number">5</span>] != <span class="string">&#x27;&#123;&#x27;</span> <span class="keyword">and</span> noise[i + <span class="number">5</span>] != <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">                    i = i + <span class="number">1</span></span><br><span class="line">                    a = a + noise[i + <span class="number">5</span>]</span><br><span class="line">                <span class="keyword">if</span> noise[i + <span class="number">5</span>] == <span class="string">&#x27;&#123;&#x27;</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># 碰到&quot;&#125;&quot;并且后面的四个字符是字母，就放到文件中等待下一步读取</span></span><br><span class="line">                <span class="keyword">if</span> noise[i + <span class="number">6</span>] <span class="keyword">in</span> alphabet <span class="keyword">and</span> noise[i + <span class="number">7</span>] <span class="keyword">in</span> alphabet <span class="keyword">and</span> noise[i + <span class="number">8</span>] <span class="keyword">in</span> alphabet <span class="keyword">and</span> noise[i + <span class="number">9</span>] <span class="keyword">in</span> alphabet:</span><br><span class="line">                    a = a + (noise[i + <span class="number">6</span>:i + <span class="number">10</span>])</span><br><span class="line">                    output_file.write(a+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    output_file.close()  <span class="comment">#文件关闭</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#打开文件待进一步的筛选</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        line = fp.readline()</span><br><span class="line">        <span class="keyword">while</span> line:</span><br><span class="line">            noiseflag = line.strip()</span><br><span class="line">            enc = line</span><br><span class="line">            dec = <span class="string">&#x27;actf&#x27;</span></span><br><span class="line">            k = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 前四位加密前应为&quot;actf&quot;,由此逆出key</span></span><br><span class="line">            alphabet = string.ascii_lowercase</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">                need_index = (alphabet.index(enc[i]) - alphabet.index(dec[i]) + <span class="number">26</span>) % <span class="number">26</span></span><br><span class="line">                k = k + alphabet[need_index]  </span><br><span class="line">            msg = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 定义vinegar解密算法</span></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">ciph, key</span>):</span><br><span class="line">                ret = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                i = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> ciph:</span><br><span class="line">                    <span class="keyword">if</span> m <span class="keyword">in</span> alphabet:</span><br><span class="line">                        ret = ret + alphabet[(alphabet.index(m) - alphabet.index(key[i])) % <span class="built_in">len</span>(alphabet)]</span><br><span class="line">                        i = (i + <span class="number">1</span>) % <span class="number">4</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        ret = ret + m</span><br><span class="line">                <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 如果后四位能被求出的key解密，结果位&quot;fleg&quot;,则表示筛选成功</span></span><br><span class="line">            <span class="keyword">if</span> decrypt(noiseflag, k)[-<span class="number">4</span>:] == <span class="string">&#x27;fleg&#x27;</span>:</span><br><span class="line">                dec_input = decrypt(noiseflag, k)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 未成功则再读取一行</span></span><br><span class="line">            line = fp.readline()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出解密出来的fleg字符串</span></span><br><span class="line">    <span class="built_in">print</span>(count+<span class="number">1</span>,end = <span class="string">&quot; : &quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(dec_input.encode()[:-<span class="number">4</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 向服务器发送解密后的fleg字符串，进入下一轮解密</span></span><br><span class="line">    s.sendline(dec_input.encode()[:-<span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<p>代码功能：</p>
<ol>
<li><p>连接远端，提取noise字符串</p>
</li>
<li><p>粗略筛选匹配的字符串到文本文件中</p>
</li>
<li><p>在文本文件中，一行一行读取字符串，求出key，并且验证尾部的字符串是否是”fleg”，因为key一致</p>
</li>
<li><p>筛选完成后向服务端发送解密后的fleg</p>
</li>
</ol>
<img src="/2022/05/08/CTF/2022angstromctf/image-20220508115644199.png" class="" title="image-20220508115644199">

<p>太强了，涉及到字符串的算法……</p>
<h1 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h1></p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-05-08</span><i class="fa fa-tag"></i><a class="tag" href="/tags/CTF赛后复现/" title="CTF赛后复现">CTF赛后复现 </a><span class="leancloud_visitors"></span><span>About 801 words, 2 min 40 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/">angr的学习</a></h3></div><div class="post-content"><div class="card"><p><span id="more"></span>

<h1 id="符号执行"><a href="#符号执行" class="headerlink" title="符号执行"></a>符号执行</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p><strong>符号执行</strong> （Symbolic Execution）是一种程序分析技术。其可以通过分析程序来<strong>得到让特定代码区域执行的输入</strong>。</p>
<p>使用符号执行分析一个程序时，该程序会使用符号值作为输入，而非一般执行程序时使用的具体值。在达到目标代码时，分析器可以得到相应的路径约束，然后通过约束求解器来得到可以触发目标代码的具体值。</p>
<p>符号执行技术是一种<strong>白盒</strong>的静态分析技术。即，分析程序可能的输入<strong>需要能够获取到目标源代码的支持</strong>。同时，它是静态的，因为并没有实际的执行程序本身，而是分析程序的执行路径。</p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-264878.htm">详细移步看雪</a></p>
<h2 id="python虚拟环境"><a href="#python虚拟环境" class="headerlink" title="python虚拟环境"></a>python虚拟环境</h2><p>在windows和linux中我都装的是anaconda来配置python虚拟环境。建议搭配pycharm使用</p>
<p>常用命令：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个名为py38的python3.8版本的虚拟环境：</span></span><br><span class="line">conda create -n py38 python=<span class="number">3.8</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动环境</span></span><br><span class="line">conda activate py38</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看已经安装的包</span></span><br><span class="line">pip <span class="built_in">list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出环境</span></span><br><span class="line">conda deactivate py38</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除虚拟环境中的包</span></span><br><span class="line">conda remove --name py38  package_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除环境 py38</span></span><br><span class="line">conda remove -n py38 --<span class="built_in">all</span></span><br></pre></td></tr></table></figure>

<p>用pycharm使用虚拟环境或者自带环境来新建项目，只需要找到其Python的解释器即可</p>
<p>举例我用anconda创建了一个py27的虚拟环境，在anaconda3下的envs目录下就能找到py27虚拟环境目录，在py27目录下即可看到python.exe</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506110444168.png" class="" title="image-20220506110444168">

<p>在pycharm中创建py2.7虚拟环境</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506110832517.png" class="" title="image-20220506110832517">

<p>B站有很多关于anconda虚拟环境的教程，可以去看看~</p>
<p>在kali中安装anconda的时候，遇到了两个问题</p>
<h3 id="conda命令未显示的问题"><a href="#conda命令未显示的问题" class="headerlink" title="conda命令未显示的问题"></a>conda命令未显示的问题</h3><p>在大佬aep的帮助下，得知环境变量添加错误，一般网上都把path添加在~&#x2F;.bash.rc中，而我的shell是zsh环境，所以应该把path添加在 ~&#x2F;.zshrc中</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506104316561.png" class="" title="image-20220506104316561">

<h3 id="打开终端自动进入conda环境"><a href="#打开终端自动进入conda环境" class="headerlink" title="打开终端自动进入conda环境"></a>打开终端自动进入conda环境</h3><img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506104459466.png" class="" title="image-20220506104459466">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim .condarc</span><br></pre></td></tr></table></figure>

<p>在文件中键入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto_activate_base: false</span><br></pre></td></tr></table></figure>

<h1 id="各种例题"><a href="#各种例题" class="headerlink" title="各种例题"></a>各种例题</h1><p>来自《从0到1:CTFer的成长之路》</p>
<p><a target="_blank" rel="noopener" href="https://github.com/angr/angr-doc/tree/master/examples">例题下载链接</a></p>
<h2 id="defcamp-r100"><a href="#defcamp-r100" class="headerlink" title="defcamp_r100"></a>defcamp_r100</h2><p>首先查看一下保护，没有开PIE</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506113703110.png" class="" title="image-20220506113703110">

<p>用ida分析，记录一下判断成功的地址：0x400844</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506112049415.png" class="" title="image-20220506112049415">

<p>失败的地址： 0x400855</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506112145021.png" class="" title="image-20220506112145021">

<p>官方脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#  auto_load_libs=False,阻止angr自动载入并分析依赖的库函数</span></span><br><span class="line">    p = angr.Project(<span class="string">&quot;r100&quot;</span>, auto_load_libs=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    simgr = p.factory.simulation_manager(p.factory.full_init_state())</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 需要寻找和需要规避的地址，传入的可以是数组</span></span><br><span class="line">    simgr.explore(find=<span class="number">0x400844</span>, avoid=<span class="number">0x400855</span>)</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># fund是一个表，found表示其中一条通往目标地址的路径,若找到，其类型为SimState，代表程序此时的一个状态</span></span><br><span class="line">    <span class="comment"># POSIX(Portable Operating System Interface):各种输入数据，posix.dump(0)获取标准输入(标准输入的文件句柄号为0)</span></span><br><span class="line">    <span class="keyword">return</span> simgr.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>).strip(<span class="string">b&#x27;\0\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="keyword">assert</span> main().startswith(<span class="string">b&#x27;Code_Talkers&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(main())</span><br></pre></td></tr></table></figure>

<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506112718425.png" class="" title="image-20220506112718425">

<p>官方给出的脚本跑了3秒多</p>
<h3 id="hook函数改进方法"><a href="#hook函数改进方法" class="headerlink" title="hook函数改进方法"></a>hook函数改进方法</h3><p>以下是nullbook书中给出的改进算法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 继承angr.SimProcedure类，并重写其中的run方法</span></span><br><span class="line"><span class="comment"># 通过验证函数的循环次数可以确定flag的长度为12,所以只需要让fgets函数传入12个字节的输入即可</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">my_fgets</span>(angr.SimProcedure):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># s是rdi寄存器指向的内存地址，用来存放输入数据</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self,s,num,f</span>):</span><br><span class="line">        simfd = self.state.posix.get_fd(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># read_data，存放12个输入字符即可</span></span><br><span class="line">        data,real_size = simfd.read_data(<span class="number">12</span>)</span><br><span class="line">        self.state.memory.store(s,data)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 阻止angr自动载入并分析依赖的库函数</span></span><br><span class="line">    p = angr.Project(<span class="string">&quot;r100&quot;</span>,auto_load_libs=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># hook printf函数，replace = True表示已经代替了之前的hook</span></span><br><span class="line">    p.hook_symbol(<span class="string">&#x27;printf&#x27;</span>,angr.SIM_PROCEDURES[<span class="string">&#x27;stubs&#x27;</span>][<span class="string">&#x27;ReturnUnconstrained&#x27;</span>](),replace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># hook fgets函数</span></span><br><span class="line">    p.hook_symbol(<span class="string">&#x27;fgets&#x27;</span>,my_fgets(),replace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># blank_state 手动指定程序开始地址 addr是main函数的地址</span></span><br><span class="line">    state = p.factory.blank_state(addr = <span class="number">0x4007e8</span>)</span><br><span class="line"></span><br><span class="line">    simgr = p.factory.simulation_manager(state)</span><br><span class="line">    </span><br><span class="line">    simgr.explore(find=<span class="number">0x400844</span>,avoid=<span class="number">0x400855</span>)</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> simgr.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>).strip(<span class="string">b&#x27;\0\n&#x27;</span>) </span><br><span class="line">                                                        </span><br><span class="line">                                                        </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    time_start = time.time()</span><br><span class="line">    <span class="built_in">print</span>(main())</span><br><span class="line">    time_end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(time_end - time_start)</span><br></pre></td></tr></table></figure>

<p>改进后的方法只用了1秒多！！</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506113302282.png" class="" title="image-20220506113302282">



<h2 id="baby-re（DEFCON-2016-quals）"><a href="#baby-re（DEFCON-2016-quals）" class="headerlink" title="baby-re（DEFCON 2016 quals）"></a>baby-re（DEFCON 2016 quals）</h2><img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506113623722.png" class="" title="image-20220506113623722">

<p>用ida分析，题目中是调用了12次scanf函数，将其存入到一个整形数组中，最后进入CheckSolution函数，CheckSolution非常巨大……</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506114024283.png" class="" title="image-20220506114024283">

<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506155003735.png" class="" title="image-20220506155003735">

<p>我们先来使用上一题种使用到的hook改进方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 阻止angr自动载入并分析依赖的库函数</span></span><br><span class="line">p = angr.Project(<span class="string">&quot;./baby-re&quot;</span>,auto_load_libs=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>hook scanf函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">my_scanf</span>(angr.SimProcedure):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># s是rdi寄存器指向的内存地址，用来存放输入数据</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self,fmt,des</span>):</span><br><span class="line">        simfd = self.state.posix.get_fd(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># read_data，存放4个字节即可</span></span><br><span class="line">        data,real_size = simfd.read_data(<span class="number">4</span>)</span><br><span class="line">        self.state.memory.store(des,data)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">p.hook_symbol(<span class="string">&#x27;__isoc99_scanf&#x27;</span>, my_scanf(), replace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>遇到fflush和printf函数，就直接return</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p.hook_symbol(<span class="string">&#x27;printf&#x27;</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;stubs&#x27;</span>][<span class="string">&#x27;ReturnUnconstrained&#x27;</span>](), replace=<span class="literal">True</span>)</span><br><span class="line">p.hook_symbol(<span class="string">&#x27;fflush&#x27;</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;stubs&#x27;</span>][<span class="string">&#x27;ReturnUnconstrained&#x27;</span>](), replace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<p>确定起始地址为main函数地址</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506155319187.png" class="" title="image-20220506155319187">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">state = p.factory.blank_state(addr = <span class="number">0x4025E7</span>)</span><br></pre></td></tr></table></figure>



<p>确定寻找地址：</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506154849145.png" class="" title="image-20220506154849145">

<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506154838362.png" class="" title="image-20220506154838362">

<p>规避地址：</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506154929668.png" class="" title="image-20220506154929668">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">simgr.explore(find=<span class="number">0x4028E9</span>,avoid=<span class="number">0x402941</span>)</span><br></pre></td></tr></table></figure>

<p>完整代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">my_scanf</span>(angr.SimProcedure):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># s是rdi寄存器指向的内存地址，用来存放输入数据</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self,fmt,des</span>):</span><br><span class="line">        simfd = self.state.posix.get_fd(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># read_data，存放4个字节即可</span></span><br><span class="line">        data,real_size = simfd.read_data(<span class="number">4</span>)</span><br><span class="line">        self.state.memory.store(des,data)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 阻止angr自动载入并分析依赖的库函数</span></span><br><span class="line">    p = angr.Project(<span class="string">&quot;./baby-re&quot;</span>,auto_load_libs=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    state = p.factory.blank_state(addr = <span class="number">0x4025E7</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 遇到printf函数和fflush函数，就直接return</span></span><br><span class="line">    p.hook_symbol(<span class="string">&#x27;printf&#x27;</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;stubs&#x27;</span>][<span class="string">&#x27;ReturnUnconstrained&#x27;</span>](), replace=<span class="literal">True</span>)</span><br><span class="line">    p.hook_symbol(<span class="string">&#x27;fflush&#x27;</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;stubs&#x27;</span>][<span class="string">&#x27;ReturnUnconstrained&#x27;</span>](), replace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    p.hook_symbol(<span class="string">&#x27;__isoc99_scanf&#x27;</span>, my_scanf(), replace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    simgr = p.factory.simulation_manager(state)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    simgr.explore(find=<span class="number">0x4028E9</span>,avoid=<span class="number">0x402941</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> simgr.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>)                </span><br><span class="line">                                                        </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    time_start = time.time()</span><br><span class="line">    <span class="built_in">print</span>(main())</span><br><span class="line">    time_end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(time_end - time_start)</span><br></pre></td></tr></table></figure>

<p>这种方法跑出来花了100多秒</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506155723281.png" class="" title="image-20220506155723281">



<p>如何改进？</p>
<h3 id="不运行时检查方法"><a href="#不运行时检查方法" class="headerlink" title="不运行时检查方法"></a>不运行时检查方法</h3><p>在代码中加入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">simgr.one_active.options.add(angr.options.LAZY_SOLVES)</span><br></pre></td></tr></table></figure>

<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506160616939.png" class="" title="image-20220506160616939">

<p>速度提升是质的飞跃，只花了12秒！！</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506160653888.png" class="" title="image-20220506160653888">



<p>能否再提升效率呢？</p>
<p>scanf函数无法简单推断输入长度，所以有时候需要用claripy函数手动构造收入</p>
<h3 id="导入claripy包来求解"><a href="#导入claripy包来求解" class="headerlink" title="导入claripy包来求解"></a>导入claripy包来求解</h3><p>完全可以把claripy当作z3来用，Claripy.BVS()可以直接创建符号变量，参数一为变量名，参数二为数据宽度（位数），</p>
<p>我们可以查看官方的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># let&#x27;s provide the exact variables received through the scanf so we don&#x27;t have to worry about parsing stdin into a bunch of ints.</span></span><br><span class="line">flag_chars = [claripy.BVS(<span class="string">&#x27;flag_%d&#x27;</span> % i, <span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>)]</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">my_scanf</span>(angr.SimProcedure):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, fmt, ptr</span>): <span class="comment"># pylint: disable=arguments-differ,unused-argument</span></span><br><span class="line">        self.state.mem[ptr].dword = flag_chars[self.state.<span class="built_in">globals</span>[<span class="string">&#x27;scanf_count&#x27;</span>]]</span><br><span class="line">        self.state.<span class="built_in">globals</span>[<span class="string">&#x27;scanf_count&#x27;</span>] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">proj.hook_symbol(<span class="string">&#x27;__isoc99_scanf&#x27;</span>, my_scanf(), replace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>我们可以通过以上的方式来创建用户的输入</p>
<p>但是这样的方式，我们不能再通过Dump标准输入来获得正确的输入</p>
<p>看看<a target="_blank" rel="noopener" href="https://github.com/angr/angr-doc/blob/master/examples/defcon2016quals_baby-re/solve.py">官方文档</a>是怎么处理的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># evaluate each of the flag chars against the constraints on the found state to construct the flag</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(sm.one_found.solver.<span class="built_in">eval</span>(c)) <span class="keyword">for</span> c <span class="keyword">in</span> flag_chars)</span><br><span class="line"><span class="keyword">return</span> flag</span><br></pre></td></tr></table></figure>

<p>这边贴上官方代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line"><span class="comment"># Authors: David Manouchehri &lt;manouchehri@protonmail.com&gt;</span></span><br><span class="line"><span class="comment">#          P1kachu &lt;p1kachu@lse.epita.fr&gt;</span></span><br><span class="line"><span class="comment">#          Audrey Dutcher &lt;audrey@rhelmot.io&gt;</span></span><br><span class="line"><span class="comment"># DEFCON CTF Qualifier 2016</span></span><br><span class="line"><span class="comment"># Challenge: baby-re</span></span><br><span class="line"><span class="comment"># Write-up: http://hack.carleton.team/2016/05/21/defcon-ctf-qualifier-2016-baby-re/</span></span><br><span class="line"><span class="comment"># Runtime: ~15 seconds (thanks lazy solves!)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    proj = angr.Project(<span class="string">&#x27;./baby-re&#x27;</span>, auto_load_libs=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># let&#x27;s provide the exact variables received through the scanf so we don&#x27;t have to worry about parsing stdin into a bunch of ints.</span></span><br><span class="line">    flag_chars = [claripy.BVS(<span class="string">&#x27;flag_%d&#x27;</span> % i, <span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>)]</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">my_scanf</span>(angr.SimProcedure):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, fmt, ptr</span>): <span class="comment"># pylint: disable=arguments-differ,unused-argument</span></span><br><span class="line">            self.state.mem[ptr].dword = flag_chars[self.state.<span class="built_in">globals</span>[<span class="string">&#x27;scanf_count&#x27;</span>]]</span><br><span class="line">            self.state.<span class="built_in">globals</span>[<span class="string">&#x27;scanf_count&#x27;</span>] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    proj.hook_symbol(<span class="string">&#x27;__isoc99_scanf&#x27;</span>, my_scanf(), replace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    sm = proj.factory.simulation_manager()</span><br><span class="line">    sm.one_active.options.add(angr.options.LAZY_SOLVES)</span><br><span class="line">    sm.one_active.<span class="built_in">globals</span>[<span class="string">&#x27;scanf_count&#x27;</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># search for just before the printf(&quot;%c%c...&quot;)</span></span><br><span class="line">    <span class="comment"># If we get to 0x402941, &quot;Wrong&quot; is going to be printed out, so definitely avoid that.</span></span><br><span class="line">    sm.explore(find=<span class="number">0x4028E9</span>, avoid=<span class="number">0x402941</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># evaluate each of the flag chars against the constraints on the found state to construct the flag</span></span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(sm.one_found.solver.<span class="built_in">eval</span>(c)) <span class="keyword">for</span> c <span class="keyword">in</span> flag_chars)</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="keyword">assert</span> main() == <span class="string">&#x27;Math is hard!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(main())</span><br></pre></td></tr></table></figure>

<p>惊呆我一整年，只用了9秒……</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506162807306.png" class="" title="image-20220506162807306">



<p>正想如何开了pie保护会怎样，没想到这样的例题就来了</p>
<h2 id="sakura-Hitcon-2017"><a href="#sakura-Hitcon-2017" class="headerlink" title="sakura(Hitcon 2017)"></a><strong>sakura(Hitcon 2017)</strong></h2><p>在这一题中，开了pie保护</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506163411373.png" class="" title="image-20220506163411373">

<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506164006020.png" class="" title="image-20220506164006020">

<p>这个sub_850函数要把我的ida干翻了……</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506163939122.png" class="" title="image-20220506163939122">

<p>放大sub_850函数流程图，下面有很多类似的结构，都是给rbp+var_1E49赋值0的操作，只要是这种操作，都需要去规避，那我们就需要在程序运行时，将这些地址都添加到一个列表中，所以需要用到idc对其进行提取。</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506164859454.png" class="" title="image-20220506164859454">

<p>sub_850函数开始地址：</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506165841798.png" class="" title="image-20220506165841798">

<p>sub_850函数结束地址：</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506170041205.png" class="" title="image-20220506170041205">

<p>shift+F2，开启idc，选择idapython，在其中键入：</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506171455042.png" class="" title="image-20220506171455042">

<p>nullbook中是这样尝试的，但是我没有在idc库中找到NextHead()这个API</p>
<p>查看<a target="_blank" rel="noopener" href="https://github.com/angr/angr-doc/blob/master/examples/hitcon2017_sakura/solve.py">官方文档</a>：</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506171628355.png" class="" title="image-20220506171628355">

<p>也就是用二进制方式读取数据，和nullbook中描述的类似</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506172319415.png" class="" title="image-20220506172319415">

<p>需要注意的是找到汇编指令的硬编码，用b’\xc6\x85\xB7\xE1\xFF\xFF\x00’代替即可</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506175024934.png" class="" title="image-20220506175024934">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">simgr.explore(find = (<span class="number">0x110CA</span>+<span class="number">0x400000</span>),avoid = avoids)</span><br></pre></td></tr></table></figure>

<p>以下是总结nullbook和官方文档的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    e = <span class="built_in">open</span>(<span class="string">&quot;./sakura&quot;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">    avoids = []</span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        index = e.find(<span class="string">b&#x27;\xc6\x85\xB7\xE1\xFF\xFF\x00&#x27;</span>,index+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> index == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        addr = <span class="number">0x400000</span> + index</span><br><span class="line">        avoids.append(addr)</span><br><span class="line"></span><br><span class="line">    avoids.append(<span class="number">0x110EC</span>+<span class="number">0x400000</span>)  <span class="comment"># 没有成功输出flag的位置</span></span><br><span class="line"></span><br><span class="line">    proj = angr.Project(<span class="string">&#x27;./sakura&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    state = proj.factory.entry_state()</span><br><span class="line"></span><br><span class="line">    simgr = proj.factory.simulation_manager(state)</span><br><span class="line"></span><br><span class="line">    simgr.one_active.options.add(angr.options.LAZY_SOLVES)</span><br><span class="line"></span><br><span class="line">    simgr.explore(find = (<span class="number">0x110CA</span>+<span class="number">0x400000</span>),avoid = avoids)</span><br><span class="line"></span><br><span class="line">    found = simgr.one_found</span><br><span class="line">    </span><br><span class="line">    text = found.solver.<span class="built_in">eval</span>(found.memory.load(<span class="number">0x612040</span>,<span class="number">400</span>), cast_to=<span class="built_in">bytes</span>)</span><br><span class="line"></span><br><span class="line">    h = hashlib.sha256(text)</span><br><span class="line">    flag = <span class="string">&#x27;hitcon&#123;&#x27;</span>+h.hexdigest()+<span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    time_start = time.time()</span><br><span class="line">    <span class="built_in">print</span>(main())</span><br><span class="line">    time_end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(time_end - time_start)</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220506174253359.png" class="" title="image-20220506174253359">

<p>当然nullbook书中介绍了更好的hook方法，以及跳过读取flag的步骤，将输入直接存放在内存中</p>
<h2 id="2020虎符-enc-pe文件-x2F-单个函数angr执行"><a href="#2020虎符-enc-pe文件-x2F-单个函数angr执行" class="headerlink" title="2020虎符 enc (pe文件&#x2F;单个函数angr执行)"></a>2020虎符 enc (pe文件&#x2F;单个函数angr执行)</h2><img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220508092835431.png" class="" title="image-20220508092835431">

<p>主要的函数就两个，sub_441050和sub_4412A0</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220508093316706.png" class="" title="image-20220508093316706">

<p>可以通过特征码或者插件得知sub_441050这个函数是md5加密算法</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220508093336127.png" class="" title="image-20220508093336127">

<p>（这边主要想学习一下angr的知识）</p>
<p>通过大佬的神之动调，我们得知传入的v11的值为794c87696d24d16e7b9e3dddad778c93</p>
<p>下面sub_4012A0很复杂，这边贴上大佬的代码(orz)，学一下从单个函数开始的angr执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> angr <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> claripy <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag=BVS(<span class="string">&#x27;flag&#x27;</span>,<span class="number">8</span>*<span class="number">16</span>) <span class="comment">#flag的长度16字节 BVS创造输入</span></span><br><span class="line">result=BVV(<span class="string">b&#x27;\xae\xed\x13\x5c\xbd\xd2\xa1\x74\x9c\x4c\x5e\x02\xd3\x28\x9b\x60&#x27;</span>,<span class="number">8</span>*<span class="number">16</span>) <span class="comment">#创建变量</span></span><br><span class="line">disasm=BVV(<span class="string">b&#x27;794c87696d24d16e7b9e3dddad778c93&#x27;</span>,<span class="number">8</span>*<span class="number">32</span>) <span class="comment">#创建变量</span></span><br><span class="line">p=Project(<span class="string">&#x27;task.exe&#x27;</span>,auto_load_libs=<span class="literal">False</span>) <span class="comment">#是否自动载入依赖的库</span></span><br><span class="line">p.hook(<span class="number">0x405128</span>,SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;malloc&#x27;</span>]()) <span class="comment">#hook SIM_PROCEDURES[&#x27;模块名&#x27;][&#x27;库函数名&#x27;]</span></span><br><span class="line">p.hook(<span class="number">0x4035e4</span>,SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;calloc&#x27;</span>]())</span><br><span class="line">st=p.factory.full_init_state(addr=<span class="number">0x40154d</span>,add_options=&#123;</span><br><span class="line">    options.SYMBOLTC_WRITE_ADDRESSES,</span><br><span class="line">options.REGION_MAPPING,options.SYMBOL_FILL_UNCONSTRAINED_REGISTERS&#125;) <span class="comment">#设置引擎</span></span><br><span class="line"></span><br><span class="line">st.memory.store(st.regs.ebp - <span class="number">0x24</span>, flag) <span class="comment">#传入参数</span></span><br><span class="line">st.memory.store(st.regs.ebp - <span class="number">0x54</span>, disasm) <span class="comment">#传入参数</span></span><br><span class="line">sim = p.factory.simgr(st)  <span class="comment">#模拟执行</span></span><br><span class="line">sim.explore(find=<span class="number">0x401558</span>) <span class="comment">#正确的位置</span></span><br><span class="line">f = sim.one_found</span><br><span class="line">f.solver.add(f.memory.load(f.regs.ebp - <span class="number">0x24</span>, <span class="number">16</span>) == result) <span class="comment">#添加约束条件</span></span><br><span class="line"><span class="built_in">print</span>(f.solver.<span class="built_in">eval</span>(flag, cast_to=<span class="built_in">bytes</span>)) <span class="comment">#打印输入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#只模拟执行4012a0加密函数</span></span><br></pre></td></tr></table></figure>

<ol>
<li>是构造参数，</li>
</ol>
<p>函数加密之后的结果就写入flag.txt.enc中了，所以我们用010查看</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220507225410464.png" class="" title="image-20220507225410464">

<p>用claripy.BVV()函数来构造位向量值。一参是值，二参是位数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result=BVV(<span class="string">b&#x27;\xae\xed\x13\x5c\xbd\xd2\xa1\x74\x9c\x4c\x5e\x02\xd3\x28\x9b\x60&#x27;</span>,<span class="number">8</span>*<span class="number">16</span>) </span><br></pre></td></tr></table></figure>

<ol start="2">
<li>构造flag值，claripy.BVS()可以直接创建位向量符号，就像z3中的BitVec一样一参为变量名，二参为位数。由上面的步骤，可以知道flag是16个字节的长度</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag=BVS(<span class="string">&#x27;flag&#x27;</span>,<span class="number">8</span>*<span class="number">16</span>) </span><br></pre></td></tr></table></figure>

<ol start="3">
<li>hook一些没有帮助的函数</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p.hook(<span class="number">0x405128</span>,SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;malloc&#x27;</span>]()) <span class="comment">#hook SIM_PROCEDURES[&#x27;模块名&#x27;][&#x27;库函数名&#x27;]</span></span><br><span class="line">p.hook(<span class="number">0x4035e4</span>,SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;calloc&#x27;</span>]())</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>创建工程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">st=p.factory.full_init_state(addr=<span class="number">0x40154d</span>,add_options=&#123;</span><br><span class="line">    options.SYMBOLTC_WRITE_ADDRESSES,</span><br><span class="line">options.REGION_MAPPING,options.SYMBOL_FILL_UNCONSTRAINED_REGISTERS&#125;) <span class="comment">#设置引擎</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>函数的参数传递，看ida就很清晰了</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">st.memory.store(st.regs.ebp - <span class="number">0x24</span>, flag) <span class="comment">#传入参数二</span></span><br><span class="line">st.memory.store(st.regs.ebp - <span class="number">0x54</span>, disasm) <span class="comment">#传入参数一</span></span><br></pre></td></tr></table></figure>

<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220507223252977.png" class="" title="image-20220507223252977">

<ol start="6">
<li>模拟执行</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sim = p.factory.simgr(st)  <span class="comment">#模拟执行</span></span><br></pre></td></tr></table></figure>

<ol start="7">
<li>确定寻找的地方（即下一条语句的开始点）</li>
</ol>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220507231226542.png" class="" title="image-20220507231226542">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sim.explore(find=<span class="number">0x401558</span>) <span class="comment">#正确的位置</span></span><br></pre></td></tr></table></figure>

<ol start="8">
<li>为出路 f 添加约束条件，结果要与flag.txt.enc文件中的内容一致</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = sim.one_found</span><br><span class="line">f.solver.add(f.memory.load(f.regs.ebp - <span class="number">0x24</span>, <span class="number">16</span>) == result) </span><br></pre></td></tr></table></figure>

<p>​    v11经过函数运算之后，值传递给了Buffer<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220507231515691.png" class="" title="image-20220507231515691"></p>
<ol start="9">
<li>输出flag</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(f.solver.<span class="built_in">eval</span>(flag, cast_to=<span class="built_in">bytes</span>)) <span class="comment">#打印输入</span></span><br></pre></td></tr></table></figure>

<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220507231713182.png" class="" title="image-20220507231713182">

<p>佩服，五体投地……(orz)</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220508094751562.png" class="" title="image-20220508094751562">



<h2 id="CSCI-4968-MBE"><a href="#CSCI-4968-MBE" class="headerlink" title="CSCI-4968-MBE"></a>CSCI-4968-MBE</h2><h3 id="crackme0x00a"><a href="#crackme0x00a" class="headerlink" title="crackme0x00a"></a>crackme0x00a</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">    congras=<span class="number">0x08048533</span></span><br><span class="line">    wrong=<span class="number">0x08048554</span></span><br><span class="line"></span><br><span class="line">    p = angr.Project(<span class="string">&quot;crackme0x00a&quot;</span>, auto_load_libs=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    p.hook_symbol(<span class="string">&#x27;printf&#x27;</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;stubs&#x27;</span>][<span class="string">&#x27;ReturnUnconstrained&#x27;</span>](), replace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    state = p.factory.full_init_state()</span><br><span class="line">    simgr = p.factory.simulation_manager(state)</span><br><span class="line"></span><br><span class="line">    simgr.one_active.options.add(angr.options.LAZY_SOLVES)</span><br><span class="line">    simgr.explore(find=congras, avoid=wrong)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> simgr.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>).strip(<span class="string">b&#x27;\0\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    time_start = time.time()</span><br><span class="line">    <span class="built_in">print</span>(main())</span><br><span class="line">    time_end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(time_end - time_start)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;g00dJ0B!</span></span><br><span class="line"><span class="comment"># 1.2658519744873047</span></span><br></pre></td></tr></table></figure>

<p>crackme0x01,    crackme0x02,crackme0x03和以上类似</p>
<h3 id="crackme0x04"><a href="#crackme0x04" class="headerlink" title="crackme0x04"></a>crackme0x04</h3><p>直接看crackme0x04，以下是流程图</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220511102149303.png" class="" title="image-20220511102149303">

<p>两重判断，官方文档中使用的是控制流图CFG()函数，去寻找exit函数的地址，自动识别正确的地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FIND_ADDR = cfg.kb.functions.function(name=<span class="string">&quot;exit&quot;</span>).addr</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">    AVOID_ADDR = <span class="number">0x080484fb</span></span><br><span class="line"></span><br><span class="line">    p = angr.Project(<span class="string">&quot;crackme0x04&quot;</span>, auto_load_libs=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    p.hook_symbol(<span class="string">&#x27;_printf&#x27;</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;stubs&#x27;</span>][<span class="string">&#x27;ReturnUnconstrained&#x27;</span>](), replace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    cfg = p.analyses.CFG()</span><br><span class="line"></span><br><span class="line">    FIND_ADDR = cfg.kb.functions.function(name=<span class="string">&quot;exit&quot;</span>).addr</span><br><span class="line"></span><br><span class="line">    simgr = p.factory.simulation_manager()</span><br><span class="line"></span><br><span class="line">    simgr.explore(find = FIND_ADDR,avoid = AVOID_ADDR)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> simgr.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    time_start = time.time()</span><br><span class="line">    <span class="built_in">print</span>(main())</span><br><span class="line">    time_end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(time_end - time_start)</span><br></pre></td></tr></table></figure>



<h2 id="crackme0x05"><a href="#crackme0x05" class="headerlink" title="crackme0x05"></a>crackme0x05</h2><p>函数的意思，相当于三重判断</p>
<p>mian函数</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220511103346668.png" class="" title="image-20220511103346668">

<p>check()函数</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220511103400340.png" class="" title="image-20220511103400340">

<p>parell()函数</p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220511103432844.png" class="" title="image-20220511103432844">

<p>三重判断？看官方文档：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Author: David Manouchehri &lt;manouchehri@protonmail.com&gt;</span></span><br><span class="line"><span class="comment"># Modern Binary Exploitation</span></span><br><span class="line"><span class="comment"># http://security.cs.rpi.edu/courses/binexp-spring2015/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    proj = angr.Project(<span class="string">&#x27;crackme0x05&#x27;</span>, load_options=&#123;<span class="string">&quot;auto_load_libs&quot;</span>: <span class="literal">False</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Author: David Manouchehri &lt;manouchehri@protonmail.com&gt;</span></span><br><span class="line"><span class="comment"># Modern Binary Exploitation</span></span><br><span class="line"><span class="comment"># http://security.cs.rpi.edu/courses/binexp-spring2015/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    proj = angr.Project(<span class="string">&#x27;crackme0x05&#x27;</span>, load_options=&#123;<span class="string">&quot;auto_load_libs&quot;</span>: <span class="literal">False</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">correct</span>(<span class="params">state</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b&#x27;Password OK&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrong</span>(<span class="params">state</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b&#x27;Password Incorrect&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    sm = proj.factory.simulation_manager()</span><br><span class="line">    sm.explore(find=correct, avoid=wrong)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#print(sm.found[0].posix.dumps(1))</span></span><br><span class="line">    <span class="keyword">return</span> sm.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>) <span class="comment"># .lstrip(&#x27;+0&#x27;).rstrip(&#x27;B&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">	<span class="comment"># it SHOULD just be two numbers but the way angr models scanf means that it could technically be any number of formats</span></span><br><span class="line">	<span class="comment"># so we gotta check against ground truth</span></span><br><span class="line">	<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;input&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">		fp.write(main())</span><br><span class="line"></span><br><span class="line">	<span class="keyword">assert</span> subprocess.check_output(<span class="string">&#x27;./crackme0x05 &lt; input&#x27;</span>, shell=<span class="literal">True</span>) == <span class="string">b&#x27;IOLI Crackme Level 0x05\nPassword: Password OK!\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">repr</span>(main()))</span><br></pre></td></tr></table></figure>

<p>这次官方文档给出的意思就是explore()函数中，传入的不是地址，也不是地址数组，而是函数</p>
<p>大概意思就是这个程序的输入是否存在目标字符串，贴上<a target="_blank" rel="noopener" href="https://blog.csdn.net/doudoudouzoule/article/details/79969793">大佬的解释</a></p>
<img src="/2022/05/06/reverse/angr%E7%9A%84%E5%AD%A6%E4%B9%A0/image-20220511104046668.png" class="" title="image-20220511104046668">
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-05-06</span><i class="fa fa-tag"></i><a class="tag" href="/tags/reverse/" title="reverse">reverse </a><span class="leancloud_visitors"></span><span>About 4018 words, 13 min 23 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2022/05/02/CTF/2022NahamConCTF/">2022NahamConCTF</a></h3></div><div class="post-content"><div class="card"><p><span id="more"></span>

<p>这边只记录一些有意思的题，主要是记录复现题</p>
<h1 id="unimod"><a href="#unimod" class="headerlink" title="unimod"></a>unimod</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">ct = <span class="string">&#x27;&#x27;</span></span><br><span class="line">k = random.randrange(<span class="number">0</span>,<span class="number">0xFFFD</span>)</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> flag:</span><br><span class="line">    ct += <span class="built_in">chr</span>((<span class="built_in">ord</span>(c) + k) % <span class="number">0xFFFD</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;out&#x27;</span>, <span class="string">&#x27;w&#x27;</span>).write(ct)</span><br><span class="line"><span class="comment"># out文件</span></span><br><span class="line"><span class="comment"># 饇饍饂饈饜餕饆餗餙饅餒餗饂餗餒饃饄餓饆饂餘餓饅餖饇餚餘餒餔餕餕饆餙餕饇餒餒饞飫</span></span><br></pre></td></tr></table></figure>

<p>我猜测是unnicode编码，找个<a target="_blank" rel="noopener" href="https://tool.chinaz.com/tools/unicode.aspx">网站</a>转一下</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502135238264.png" class="" title="image-20220502135238264">

<p>flag第一个字符为”f”，算出k，即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ct = [<span class="number">0x9947</span>,<span class="number">0x994d</span>,<span class="number">0x9942</span>,<span class="number">0x9948</span>,<span class="number">0x995c</span>,<span class="number">0x9915</span>,<span class="number">0x9946</span>,<span class="number">0x9917</span>,<span class="number">0x9919</span>,<span class="number">0x9945</span>,<span class="number">0x9912</span>,<span class="number">0x9917</span>,<span class="number">0x9942</span>,<span class="number">0x9917</span>,<span class="number">0x9912</span>,<span class="number">0x9943</span>,<span class="number">0x9944</span>,<span class="number">0x9913</span>,<span class="number">0x9946</span>,<span class="number">0x9942</span>,<span class="number">0x9918</span>,<span class="number">0x9913</span>,<span class="number">0x9945</span>,<span class="number">0x9916</span>,<span class="number">0x9947</span>,<span class="number">0x991a</span>,<span class="number">0x9918</span>,<span class="number">0x9912</span>,<span class="number">0x9914</span>,<span class="number">0x9915</span>,<span class="number">0x9915</span>,<span class="number">0x9946</span>,<span class="number">0x9919</span>,<span class="number">0x9915</span>,<span class="number">0x9947</span>,<span class="number">0x9912</span>,<span class="number">0x9912</span>,<span class="number">0x995e</span>,<span class="number">0x98eb</span>]</span><br><span class="line">k = ct[<span class="number">0</span>]-<span class="built_in">ord</span>(<span class="string">&quot;f&quot;</span>)</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ct:</span><br><span class="line">	flag +=  <span class="built_in">chr</span>(i-k)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># flag&#123;4e68d16a61bc2ea72d5f971344e84f11&#125;</span></span><br></pre></td></tr></table></figure>



<h1 id="BabyRSAQuiz"><a href="#BabyRSAQuiz" class="headerlink" title="BabyRSAQuiz"></a>BabyRSAQuiz</h1><p>这一题还是很有趣的，一共三个挑战，对应三个不同的rsa题型</p>
<p>第一个是最基础的题型</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502114542571.png" class="" title="image-20220502114542571">

<p>第二个是低加密指数攻击，对n开三次方即可</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502114639960.png" class="" title="image-20220502114639960">

<p>第三个，给出了p和q的大致关系，需要爆破一下，耽搁了挺久的</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502114808336.png" class="" title="image-20220502114808336">



<p>解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> number</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge3</span>():</span><br><span class="line">	n = <span class="number">116977074228599426291587221908436017777467258431559447697924941520570885658886480019669892575150152280335170175559423087532259109936665895429503951416006622462618553942370439526762985810142970058271286185509592222692211236949490404435899918812532981985758364660301644565952909138955690838261582018908922468119</span></span><br><span class="line">	s = gmpy2.iroot(n,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">		a = <span class="number">2</span>*i</span><br><span class="line">		m = (s-a+<span class="number">1</span>)*(s+a+<span class="number">1</span>)</span><br><span class="line">		re = n - m</span><br><span class="line">		<span class="keyword">if</span> m == n:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;done&quot;</span>)</span><br><span class="line">			<span class="built_in">print</span>((s-<span class="number">2</span>*i+<span class="number">1</span>),(s+(<span class="number">2</span>*i+<span class="number">1</span>)))</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">elif</span> re &gt;-<span class="number">200000</span> <span class="keyword">and</span> re &lt; <span class="number">200000</span>:</span><br><span class="line">			<span class="built_in">print</span>(-a+<span class="number">1</span>,a+<span class="number">1</span>)</span><br><span class="line">			<span class="built_in">print</span>(re)</span><br><span class="line">	p = s - <span class="number">308</span></span><br><span class="line">	q = s + <span class="number">310</span></span><br><span class="line">	e = <span class="number">65537</span></span><br><span class="line">	c = <span class="number">4229254487221676800780096678163450260842675507793572972787457878570797072562036544554415758463878561718810656685314768162698600790351018583535201368597827407410173247765734037714029965319789400903852994184676867936771131535515140905245959496886324335917176883986099816968694152979333841398712040545041994202</span></span><br><span class="line">	d = gmpy2.invert(e,(q-<span class="number">1</span>)*(p-<span class="number">1</span>))</span><br><span class="line">	m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">	<span class="built_in">print</span>(m)</span><br><span class="line">	<span class="built_in">print</span>(number.long_to_bytes(m))</span><br><span class="line">challenge3()</span><br></pre></td></tr></table></figure>

<p>s是n开方之后的结果，通过爆破p和q，获取p*q的值与n的差值，可以确定p &#x3D; (s-2i)，q &#x3D; (s+2i) ,这样我我们就能确定p和q相对于s的偏移，即可确定p和q的值，进而求解</p>
<h1 id="XORROX"><a href="#XORROX" class="headerlink" title="XORROX"></a>XORROX</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">r/<span class="built_in">bin</span>/env python3</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> filp:</span><br><span class="line">    flag = filp.read().strip()</span><br><span class="line"></span><br><span class="line">key = [random.randint(<span class="number">1</span>, <span class="number">256</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag))]</span><br><span class="line"></span><br><span class="line">xorrox = []</span><br><span class="line">enc = []</span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(key):</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        k ^= key[j]</span><br><span class="line">    xorrox.append(k)</span><br><span class="line">    enc.append(flag[i] ^ v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> filp:</span><br><span class="line">    filp.write(<span class="string">f&quot;<span class="subst">&#123;xorrox=&#125;</span>\n&quot;</span>)</span><br><span class="line">    filp.write(<span class="string">f&quot;<span class="subst">&#123;enc=&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># output文件</span></span><br><span class="line"><span class="comment">#xorrox=[1, 209, 108, 239, 4, 55, 34, 174, 79, 117, 8, 222, 123, 99, 184, 202, 95, 255, 175, 138, 150, 28, 183, 6, 168, 43, 205, 105, 92, 250, 28, 80, 31, 201, 46, 20, 50, 56]</span></span><br><span class="line"><span class="comment">#enc=[26, 188, 220, 228, 144, 1, 36, 185, 214, 11, 25, 178, 145, 47, 237, 70, 244, 149, 98, 20, 46, 187, 207, 136, 154, 231, 131, 193, 84, 148, 212, 126, 126, 226, 211, 10, 20, 119]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这题还是需要去找规律的，不理解意思，硬逆是行不通的</p>
<p>题目首先是随机产生了flag长度的key，然后对每个key[i]与key[0]……key[i-1]元素进行异或，并且将最后异或完成的key[i]值与flag进行异或，所以我们需要求得key列表</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502132229290.png" class="" title="image-20220502132229290">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">xorrox=[<span class="number">1</span>, <span class="number">209</span>, <span class="number">108</span>, <span class="number">239</span>, <span class="number">4</span>, <span class="number">55</span>, <span class="number">34</span>, <span class="number">174</span>, <span class="number">79</span>, <span class="number">117</span>, <span class="number">8</span>, <span class="number">222</span>, <span class="number">123</span>, <span class="number">99</span>, <span class="number">184</span>, <span class="number">202</span>, <span class="number">95</span>, <span class="number">255</span>, <span class="number">175</span>, <span class="number">138</span>, <span class="number">150</span>, <span class="number">28</span>, <span class="number">183</span>, <span class="number">6</span>, <span class="number">168</span>, <span class="number">43</span>, <span class="number">205</span>, <span class="number">105</span>, <span class="number">92</span>, <span class="number">250</span>, <span class="number">28</span>, <span class="number">80</span>, <span class="number">31</span>, <span class="number">201</span>, <span class="number">46</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">56</span>]</span><br><span class="line">enc=[<span class="number">26</span>, <span class="number">188</span>, <span class="number">220</span>, <span class="number">228</span>, <span class="number">144</span>, <span class="number">1</span>, <span class="number">36</span>, <span class="number">185</span>, <span class="number">214</span>, <span class="number">11</span>, <span class="number">25</span>, <span class="number">178</span>, <span class="number">145</span>, <span class="number">47</span>, <span class="number">237</span>, <span class="number">70</span>, <span class="number">244</span>, <span class="number">149</span>, <span class="number">98</span>, <span class="number">20</span>, <span class="number">46</span>, <span class="number">187</span>, <span class="number">207</span>, <span class="number">136</span>, <span class="number">154</span>, <span class="number">231</span>, <span class="number">131</span>, <span class="number">193</span>, <span class="number">84</span>, <span class="number">148</span>, <span class="number">212</span>, <span class="number">126</span>, <span class="number">126</span>, <span class="number">226</span>, <span class="number">211</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">119</span>]</span><br><span class="line"><span class="comment"># for i, v in enumerate(key):</span></span><br><span class="line">key = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># key = [124, 208, 189, 131, 235]</span></span><br><span class="line"><span class="comment"># for i, v in enumerate(key):</span></span><br><span class="line">flag = [<span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">123</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(xorrox)-<span class="number">1</span>):</span><br><span class="line">    key.append(xorrox[i]^xorrox[i+<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">key = [<span class="number">124</span>,<span class="number">208</span>, <span class="number">189</span>, <span class="number">131</span>, <span class="number">235</span>, <span class="number">51</span>, <span class="number">21</span>, <span class="number">140</span>, <span class="number">225</span>, <span class="number">58</span>, <span class="number">125</span>, <span class="number">214</span>, <span class="number">165</span>, <span class="number">24</span>, <span class="number">219</span>, <span class="number">114</span>, <span class="number">149</span>, <span class="number">160</span>, <span class="number">80</span>, <span class="number">37</span>, <span class="number">28</span>, <span class="number">138</span>, <span class="number">171</span>, <span class="number">177</span>, <span class="number">174</span>, <span class="number">131</span>, <span class="number">230</span>, <span class="number">164</span>, <span class="number">53</span>, <span class="number">166</span>, <span class="number">230</span>, <span class="number">76</span>, <span class="number">79</span>, <span class="number">214</span>, <span class="number">231</span>, <span class="number">58</span>, <span class="number">38</span>, <span class="number">10</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(key[i]^enc[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<h1 id="eayrev"><a href="#eayrev" class="headerlink" title="eayrev"></a>eayrev</h1><p>用ida打开，输入用户名之后，输入密码，进入sub_12B2函数</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502133356152.png" class="" title="image-20220502133356152">

<p>主要加密算法在这边，因为s是char*类型的指针，指向了input传参，v6是input的长度</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502133609046.png" class="" title="image-20220502133609046">



<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502133658463.png" class="" title="image-20220502133658463">

<p>加密结束之后与dword_4020数组进行比较</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502134044885.png" class="" title="image-20220502134044885">

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> ida_chars[] =</span><br><span class="line">&#123;</span><br><span class="line">  <span class="number">0x66</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xD9</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x88</span>, <span class="number">0x01</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x41</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xC0</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xF9</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xA4</span>, <span class="number">0x18</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x95</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0A</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xD5</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x7C</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xA9</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xB0</span>, <span class="number">0x07</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x69</span>, <span class="number">0x19</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x27</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xA3</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xC4</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xB9</span>, <span class="number">0x02</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x54</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x89</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x50</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF0</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x54</span>, <span class="number">0x02</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xD9</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x71</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x24</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x19</span>, <span class="number">0x10</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x42</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xAD</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xE9</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x30</span>, <span class="number">0x0A</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xE1</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x84</span>, <span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xD2</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x07</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> flag[<span class="number">40</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//printf(&quot;%d\n&quot;,sizeof(long long unsigned));</span></span><br><span class="line">    <span class="type">int</span>* px = (<span class="type">int</span> *)ida_chars;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i&lt;<span class="number">38</span>;i++)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%x\n&quot;</span>,*px);</span><br><span class="line">        flag[i] = (*px - (i*i))&gt;&gt;(i%<span class="number">7</span>);</span><br><span class="line">        px++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i&lt; <span class="number">38</span>;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,flag[i]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	getchar();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag&#123;7bdeac39cca13a97782c04522aece87a&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="Quirky"><a href="#Quirky" class="headerlink" title="Quirky"></a>Quirky</h1><p>给出的文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x89\x50\x4e\x47\x0d\x0a\x1a\x0a\x00\x00\x00\x0d\x49\x48\x44\x52\x00\x00\x00\x6f\x00\x00\x00\x6f\x01\x03\x00\x00\x00\xd8\x0b\x0c\x23\x00\x00\x00\x06\x50\x4c\x54\x45\x00\x00\x00\xff\xff\xff\xa5\xd9\x9f\xdd\x00\x00\x00\x02\x74\x52\x4e\x53\xff\xff\xc8\xb5\xdf\xc7\x00\x00\x00\x09\x70\x48\x59\x73\x00\x00\x0b\x12\x00\x00\x0b\x12\x01\xd2\xdd\x7e\xfc\x00\x00\x01\x25\x49\x44\x41\x54\x38\x8d\xd5\xd4\x31\x8e\xc3\x20\x10\x05\xd0\xb1\x5c\xd0\x25\x17\x40\x9a\x6b\xd0\x71\x25\xfb\x02\xb6\xf7\x02\xce\x95\xe8\xb8\x06\x92\x2f\x40\x3a\x0a\x94\xd9\x8f\x23\x45\xbb\xc5\x66\x68\x52\x2c\xa2\xe0\x21\x21\xcf\x0c\x83\x49\x7e\x0d\xfa\x1f\xcc\x44\x8b\xaf\x6b\xb0\x44\xac\xf2\x2e\x75\x72\xe3\x66\xea\x2a\x1d\x0c\x76\xc1\xe7\x82\x9d\x4c\x17\x27\x97\xc8\xd4\x4e\xae\x91\xd6\x62\xbb\x28\x75\x8e\xf5\x1a\xed\x2b\xc8\x37\x44\xbe\x73\xb4\x98\xaf\xf4\xdf\xf0\x1c\xf6\x5a\x7e\x16\xf6\x4f\x66\xb2\x64\x78\xf3\xc7\xee\x3a\xe8\x0f\xac\x25\x10\x39\x56\x79\x2f\x74\x71\xe3\x57\x94\x87\x11\x9d\xf1\xd8\x5b\x6c\x34\x79\x9d\x0f\x8f\xb3\xb2\xfb\x73\x53\xa5\x3b\x36\x33\xa2\xf8\x73\x60\x95\x52\xea\x10\xd3\xc5\xf0\x7e\x46\xf5\x9e\x77\x19\x6f\x6d\x4a\x76\x3a\x25\xa0\x49\xda\x05\xdd\x22\xab\x44\xbe\x38\x28\x25\xcd\xa5\x83\x92\x86\x82\x90\x0e\x14\x53\x67\x44\x1f\xd6\x39\xa0\xfe\xac\xb3\x9d\x95\xdd\x10\x19\x51\x89\x91\x3d\x21\xa4\xec\x58\x25\x3a\x76\xf2\x69\x68\xaf\x4c\x54\xe2\x2d\x2c\x1e\x95\xe4\xec\x59\x27\xae\x52\xd0\xb4\x34\x3c\xf3\x55\x89\x85\xf0\xc3\x71\x17\x0b\xdf\x42\x22\x27\x3a\xf1\x7e\xd1\x2d\x68\xaa\xa2\xb3\xe5\xdb\x3a\x56\xb2\xd1\xf9\xb9\x5f\xee\xa7\xf8\x0d\x69\xf5\x37\x77\x6e\xf8\x09\x97\x00\x00\x00\x00\x49\x45\x4e\x44\xae\x42\x60\x82</span><br></pre></td></tr></table></figure>

<p>在网上找一个数组转二进制文件的脚本跑一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">arr = [<span class="number">0x89</span>,<span class="number">0x50</span>,<span class="number">0x4e</span>,<span class="number">0x47</span>,<span class="number">0x0d</span>,<span class="number">0x0a</span>,<span class="number">0x1a</span>,<span class="number">0x0a</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0d</span>,<span class="number">0x49</span>,<span class="number">0x48</span>,<span class="number">0x44</span>,<span class="number">0x52</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x6f</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x6f</span>,<span class="number">0x01</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xd8</span>,<span class="number">0x0b</span>,<span class="number">0x0c</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x06</span>,<span class="number">0x50</span>,<span class="number">0x4c</span>,<span class="number">0x54</span>,<span class="number">0x45</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xa5</span>,<span class="number">0xd9</span>,<span class="number">0x9f</span>,<span class="number">0xdd</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x74</span>,<span class="number">0x52</span>,<span class="number">0x4e</span>,<span class="number">0x53</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xc8</span>,<span class="number">0xb5</span>,<span class="number">0xdf</span>,<span class="number">0xc7</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x09</span>,<span class="number">0x70</span>,<span class="number">0x48</span>,<span class="number">0x59</span>,<span class="number">0x73</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0b</span>,<span class="number">0x12</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0b</span>,<span class="number">0x12</span>,<span class="number">0x01</span>,<span class="number">0xd2</span>,<span class="number">0xdd</span>,<span class="number">0x7e</span>,<span class="number">0xfc</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x25</span>,<span class="number">0x49</span>,<span class="number">0x44</span>,<span class="number">0x41</span>,<span class="number">0x54</span>,<span class="number">0x38</span>,<span class="number">0x8d</span>,<span class="number">0xd5</span>,<span class="number">0xd4</span>,<span class="number">0x31</span>,<span class="number">0x8e</span>,<span class="number">0xc3</span>,<span class="number">0x20</span>,<span class="number">0x10</span>,<span class="number">0x05</span>,<span class="number">0xd0</span>,<span class="number">0xb1</span>,<span class="number">0x5c</span>,<span class="number">0xd0</span>,<span class="number">0x25</span>,<span class="number">0x17</span>,<span class="number">0x40</span>,<span class="number">0x9a</span>,<span class="number">0x6b</span>,<span class="number">0xd0</span>,<span class="number">0x71</span>,<span class="number">0x25</span>,<span class="number">0xfb</span>,<span class="number">0x02</span>,<span class="number">0xb6</span>,<span class="number">0xf7</span>,<span class="number">0x02</span>,<span class="number">0xce</span>,<span class="number">0x95</span>,<span class="number">0xe8</span>,<span class="number">0xb8</span>,<span class="number">0x06</span>,<span class="number">0x92</span>,<span class="number">0x2f</span>,<span class="number">0x40</span>,<span class="number">0x3a</span>,<span class="number">0x0a</span>,<span class="number">0x94</span>,<span class="number">0xd9</span>,<span class="number">0x8f</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0xbb</span>,<span class="number">0xc5</span>,<span class="number">0x66</span>,<span class="number">0x68</span>,<span class="number">0x52</span>,<span class="number">0x2c</span>,<span class="number">0xa2</span>,<span class="number">0xe0</span>,<span class="number">0x21</span>,<span class="number">0x21</span>,<span class="number">0xcf</span>,<span class="number">0x0c</span>,<span class="number">0x83</span>,<span class="number">0x49</span>,<span class="number">0x7e</span>,<span class="number">0x0d</span>,<span class="number">0xfa</span>,<span class="number">0x1f</span>,<span class="number">0xcc</span>,<span class="number">0x44</span>,<span class="number">0x8b</span>,<span class="number">0xaf</span>,<span class="number">0x6b</span>,<span class="number">0xb0</span>,<span class="number">0x44</span>,<span class="number">0xac</span>,<span class="number">0xf2</span>,<span class="number">0x2e</span>,<span class="number">0x75</span>,<span class="number">0x72</span>,<span class="number">0xe3</span>,<span class="number">0x66</span>,<span class="number">0xea</span>,<span class="number">0x2a</span>,<span class="number">0x1d</span>,<span class="number">0x0c</span>,<span class="number">0x76</span>,<span class="number">0xc1</span>,<span class="number">0xe7</span>,<span class="number">0x82</span>,<span class="number">0x9d</span>,<span class="number">0x4c</span>,<span class="number">0x17</span>,<span class="number">0x27</span>,<span class="number">0x97</span>,<span class="number">0xc8</span>,<span class="number">0xd4</span>,<span class="number">0x4e</span>,<span class="number">0xae</span>,<span class="number">0x91</span>,<span class="number">0xd6</span>,<span class="number">0x62</span>,<span class="number">0xbb</span>,<span class="number">0x28</span>,<span class="number">0x75</span>,<span class="number">0x8e</span>,<span class="number">0xf5</span>,<span class="number">0x1a</span>,<span class="number">0xed</span>,<span class="number">0x2b</span>,<span class="number">0xc8</span>,<span class="number">0x37</span>,<span class="number">0x44</span>,<span class="number">0xbe</span>,<span class="number">0x73</span>,<span class="number">0xb4</span>,<span class="number">0x98</span>,<span class="number">0xaf</span>,<span class="number">0xf4</span>,<span class="number">0xdf</span>,<span class="number">0xf0</span>,<span class="number">0x1c</span>,<span class="number">0xf6</span>,<span class="number">0x5a</span>,<span class="number">0x7e</span>,<span class="number">0x16</span>,<span class="number">0xf6</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0xb2</span>,<span class="number">0x64</span>,<span class="number">0x78</span>,<span class="number">0xf3</span>,<span class="number">0xc7</span>,<span class="number">0xee</span>,<span class="number">0x3a</span>,<span class="number">0xe8</span>,<span class="number">0x0f</span>,<span class="number">0xac</span>,<span class="number">0x25</span>,<span class="number">0x10</span>,<span class="number">0x39</span>,<span class="number">0x56</span>,<span class="number">0x79</span>,<span class="number">0x2f</span>,<span class="number">0x74</span>,<span class="number">0x71</span>,<span class="number">0xe3</span>,<span class="number">0x57</span>,<span class="number">0x94</span>,<span class="number">0x87</span>,<span class="number">0x11</span>,<span class="number">0x9d</span>,<span class="number">0xf1</span>,<span class="number">0xd8</span>,<span class="number">0x5b</span>,<span class="number">0x6c</span>,<span class="number">0x34</span>,<span class="number">0x79</span>,<span class="number">0x9d</span>,<span class="number">0x0f</span>,<span class="number">0x8f</span>,<span class="number">0xb3</span>,<span class="number">0xb2</span>,<span class="number">0xfb</span>,<span class="number">0x73</span>,<span class="number">0x53</span>,<span class="number">0xa5</span>,<span class="number">0x3b</span>,<span class="number">0x36</span>,<span class="number">0x33</span>,<span class="number">0xa2</span>,<span class="number">0xf8</span>,<span class="number">0x73</span>,<span class="number">0x60</span>,<span class="number">0x95</span>,<span class="number">0x52</span>,<span class="number">0xea</span>,<span class="number">0x10</span>,<span class="number">0xd3</span>,<span class="number">0xc5</span>,<span class="number">0xf0</span>,<span class="number">0x7e</span>,<span class="number">0x46</span>,<span class="number">0xf5</span>,<span class="number">0x9e</span>,<span class="number">0x77</span>,<span class="number">0x19</span>,<span class="number">0x6f</span>,<span class="number">0x6d</span>,<span class="number">0x4a</span>,<span class="number">0x76</span>,<span class="number">0x3a</span>,<span class="number">0x25</span>,<span class="number">0xa0</span>,<span class="number">0x49</span>,<span class="number">0xda</span>,<span class="number">0x05</span>,<span class="number">0xdd</span>,<span class="number">0x22</span>,<span class="number">0xab</span>,<span class="number">0x44</span>,<span class="number">0xbe</span>,<span class="number">0x38</span>,<span class="number">0x28</span>,<span class="number">0x25</span>,<span class="number">0xcd</span>,<span class="number">0xa5</span>,<span class="number">0x83</span>,<span class="number">0x92</span>,<span class="number">0x86</span>,<span class="number">0x82</span>,<span class="number">0x90</span>,<span class="number">0x0e</span>,<span class="number">0x14</span>,<span class="number">0x53</span>,<span class="number">0x67</span>,<span class="number">0x44</span>,<span class="number">0x1f</span>,<span class="number">0xd6</span>,<span class="number">0x39</span>,<span class="number">0xa0</span>,<span class="number">0xfe</span>,<span class="number">0xac</span>,<span class="number">0xb3</span>,<span class="number">0x9d</span>,<span class="number">0x95</span>,<span class="number">0xdd</span>,<span class="number">0x10</span>,<span class="number">0x19</span>,<span class="number">0x51</span>,<span class="number">0x89</span>,<span class="number">0x91</span>,<span class="number">0x3d</span>,<span class="number">0x21</span>,<span class="number">0xa4</span>,<span class="number">0xec</span>,<span class="number">0x58</span>,<span class="number">0x25</span>,<span class="number">0x3a</span>,<span class="number">0x76</span>,<span class="number">0xf2</span>,<span class="number">0x69</span>,<span class="number">0x68</span>,<span class="number">0xaf</span>,<span class="number">0x4c</span>,<span class="number">0x54</span>,<span class="number">0xe2</span>,<span class="number">0x2d</span>,<span class="number">0x2c</span>,<span class="number">0x1e</span>,<span class="number">0x95</span>,<span class="number">0xe4</span>,<span class="number">0xec</span>,<span class="number">0x59</span>,<span class="number">0x27</span>,<span class="number">0xae</span>,<span class="number">0x52</span>,<span class="number">0xd0</span>,<span class="number">0xb4</span>,<span class="number">0x34</span>,<span class="number">0x3c</span>,<span class="number">0xf3</span>,<span class="number">0x55</span>,<span class="number">0x89</span>,<span class="number">0x85</span>,<span class="number">0xf0</span>,<span class="number">0xc3</span>,<span class="number">0x71</span>,<span class="number">0x17</span>,<span class="number">0x0b</span>,<span class="number">0xdf</span>,<span class="number">0x42</span>,<span class="number">0x22</span>,<span class="number">0x27</span>,<span class="number">0x3a</span>,<span class="number">0xf1</span>,<span class="number">0x7e</span>,<span class="number">0xd1</span>,<span class="number">0x2d</span>,<span class="number">0x68</span>,<span class="number">0xaa</span>,<span class="number">0xa2</span>,<span class="number">0xb3</span>,<span class="number">0xe5</span>,<span class="number">0xdb</span>,<span class="number">0x3a</span>,<span class="number">0x56</span>,<span class="number">0xb2</span>,<span class="number">0xd1</span>,<span class="number">0xf9</span>,<span class="number">0xb9</span>,<span class="number">0x5f</span>,<span class="number">0xee</span>,<span class="number">0xa7</span>,<span class="number">0xf8</span>,<span class="number">0x0d</span>,<span class="number">0x69</span>,<span class="number">0xf5</span>,<span class="number">0x37</span>,<span class="number">0x77</span>,<span class="number">0x6e</span>,<span class="number">0xf8</span>,<span class="number">0x09</span>,<span class="number">0x97</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x49</span>,<span class="number">0x45</span>,<span class="number">0x4e</span>,<span class="number">0x44</span>,<span class="number">0xae</span>,<span class="number">0x42</span>,<span class="number">0x60</span>,<span class="number">0x82</span>]</span><br><span class="line"> <span class="comment">#待写入的数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./testfile.png&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> arr:</span><br><span class="line">        s = struct.pack(<span class="string">&#x27;B&#x27;</span>,x)<span class="comment">#转换为字节流字符串，B代表unsigned char</span></span><br><span class="line">        fp.write(s)</span><br></pre></td></tr></table></figure>

<p>之后就会出一个二维码，扫描即可</p>
<h1 id="moblize-复现"><a href="#moblize-复现" class="headerlink" title="moblize [复现]"></a>moblize [复现]</h1><p>这题记得是没在模拟器上安装成功，就跳过了<img src="/2022/05/02/CTF/2022NahamConCTF/B779572406684EA8E8D7BF86437BE38E.jpg" class="" title="img"></p>
<p>赛后复现就尴尬了</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502141100252.png" class="" title="image-20220502141100252">

<h1 id="OTP-Vault-ReactJS逆向-复现"><a href="#OTP-Vault-ReactJS逆向-复现" class="headerlink" title="OTP Vault (ReactJS逆向)[复现]"></a>OTP Vault (ReactJS逆向)[复现]</h1><p><a target="_blank" rel="noopener" href="https://github.com/evyatar9/Writeups/tree/master/CTFs/2022-NahamCon_CTF/Mobile/OTP_Vault">参考链接：</a></p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502141620556.png" class="" title="image-20220502141620556">

<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502201537918.png" class="" title="image-20220502201537918">

<p>使用apktool</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apk -d OTPVault.apk</span><br></pre></td></tr></table></figure>

<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502180038142.png" class="" title="image-20220502180038142">

<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502201618487.png" class="" title="image-20220502201618487">

<p>不知道能从jadx反汇编的什么特征，得知该程序是使用ReactJS构建的</p>
<p>wp中使用的是以下的工具来反汇编assets目录下的index.android.bundle，需要node环境</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502180418006.png" class="" title="image-20220502180418006">



<p>在windows中安装就可以了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i -g react-native-decompiler</span><br><span class="line">npx react-native-decompiler -i ./index.android.bundle -o ./output</span><br></pre></td></tr></table></figure>



<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502182804505.png" class="" title="image-20220502182804505">

<p>后面发现提取出来的文件有很多的时候，还是转linux了，需要配置一下npm</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502191107317.png" class="" title="image-20220502191107317">



<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502194047919.png" class="" title="image-20220502194047919">



<p>–更新–</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_38124502/article/details/119513327">参考博客</a></p>
<p>方法原来不止一种，上述方法确实太过麻烦</p>
<p>直接把apk后缀改成zip,解压出来，找到assets下面的index.android.bundle，直接用notepad打开，复制代码到VScode中，shift+alt+f，代码格式化，搜索失败字符串”Invalid OTP”。</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502201239959.png" class="" title="image-20220502201239959">

<p>我以为要构造头呢……</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/image-20220502205058946.png" class="" title="image-20220502205058946">

<p>直接上hackbar就行了</p>
<p>flag{5450384e093a0444e6d3d39795dd7ddd}</p>
<h1 id="clickme-复现"><a href="#clickme-复现" class="headerlink" title="clickme [复现]"></a>clickme [复现]</h1><p>模拟器版本太低，不能安装</p>
<img src="/2022/05/02/CTF/2022NahamConCTF/3C5B3487E4415070945D96474BDEF92B.jpg" class="" title="img">

</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-05-02</span><i class="fa fa-tag"></i><a class="tag" href="/tags/CTF赛后复现/" title="CTF赛后复现">CTF赛后复现 </a><span class="leancloud_visitors"></span><span>About 2337 words, 7 min 47 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2022/04/27/CTF/2022MRCTF/">2022MRCTF</a></h3></div><div class="post-content"><div class="card"><p><span id="more"></span>

<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="old"><a href="#old" class="headerlink" title="old"></a>old</h2><img src="/2022/04/27/CTF/2022MRCTF/image-20220427194710230.png" class="" title="image-20220427194710230">

<img src="/2022/04/27/CTF/2022MRCTF/image-20220427195351136.png" class="" title="image-20220427195351136">



<img src="/2022/04/27/CTF/2022MRCTF/image-20220427195716694.png" class="" title="image-20220427195716694">



<img src="/2022/04/27/CTF/2022MRCTF/image-20220427200934500.png" class="" title="image-20220427200934500">



<img src="/2022/04/27/CTF/2022MRCTF/image-20220427201811088.png" class="" title="image-20220427201811088">



<img src="/2022/04/27/CTF/2022MRCTF/image-20220427201836796.png" class="" title="image-20220427201836796">
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-04-27</span><i class="fa fa-tag"></i><a class="tag" href="/tags/CTF赛后复现/" title="CTF赛后复现">CTF赛后复现 </a><span class="leancloud_visitors"></span><span>About 1 words, 0 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2022/04/27/%E7%AE%97%E6%B3%95/CTF%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93-%E6%9B%B4%E6%96%B0/">CTF常见加密算法[更新]</a></h3></div><div class="post-content"><div class="card"><p><span id="more"></span>

<p>汇总CTF常见加密算法的解密脚本</p>
<h1 id="XXtea"><a href="#XXtea" class="headerlink" title="XXtea"></a>XXtea</h1><p>具体可以查看这篇<a target="_blank" rel="noopener" href="https://qianfei11.github.io/2019/08/22/Python%E5%AE%9E%E7%8E%B0TEA%E3%80%81XTEA%E3%80%81XXTEA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95/">博客</a></p>
<p>C实现：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x9e3779b9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;5^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class="line"> </span><br><span class="line">  <span class="type">void</span> <span class="title function_">btea</span><span class="params">(<span class="type">uint32_t</span> *v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;          <span class="comment">/* Coding Part */</span></span><br><span class="line">      rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">      sum = <span class="number">0</span>;</span><br><span class="line">      z = v[n<span class="number">-1</span>];</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        sum += DELTA;</span><br><span class="line">        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (p=<span class="number">0</span>; p&lt;n<span class="number">-1</span>; p++) &#123;</span><br><span class="line">          y = v[p+<span class="number">1</span>];</span><br><span class="line">          z = v[p] += MX;</span><br><span class="line">        &#125;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        z = v[n<span class="number">-1</span>] += MX;</span><br><span class="line">      &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) &#123;  <span class="comment">/* Decoding Part */</span></span><br><span class="line">      n = -n;</span><br><span class="line">      rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">      sum = rounds*DELTA;</span><br><span class="line">      y = v[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (p=n<span class="number">-1</span>; p&gt;<span class="number">0</span>; p--) &#123;</span><br><span class="line">          z = v[p<span class="number">-1</span>];</span><br><span class="line">          y = v[p] -= MX;</span><br><span class="line">        &#125;</span><br><span class="line">        z = v[n<span class="number">-1</span>];</span><br><span class="line">        y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">      &#125; <span class="keyword">while</span> ((sum -= DELTA) != <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>]=&#123;<span class="number">0x01234567</span>,<span class="number">0x89ABCDEF</span>,<span class="number">0xFEDCBA98</span>,<span class="number">0x76543210</span>&#125;;</span><br><span class="line">    <span class="type">uint32_t</span> data[<span class="number">3</span>]=&#123;<span class="number">0x12345678</span>,<span class="number">0x87654321</span>,<span class="number">0x13579243</span>&#125;;</span><br><span class="line">    <span class="type">uint32_t</span> *sent=data;</span><br><span class="line">    btea(sent,<span class="number">3</span>,key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;coded:%x  %x  %x \n&quot;</span>,sent[<span class="number">0</span>],sent[<span class="number">1</span>],sent[<span class="number">2</span>]);</span><br><span class="line">    btea(sent,<span class="number">-3</span>,key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decoded:%x  %x  %x \n&quot;</span>,sent[<span class="number">0</span>],sent[<span class="number">1</span>],sent[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="例题1：eztea"><a href="#例题1：eztea" class="headerlink" title="例题1：eztea"></a>例题1：eztea</h2><p>解这种题目的时候要注意轮回次数以及递增变量大小</p>
<img src="/2022/04/27/%E7%AE%97%E6%B3%95/CTF%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93-%E6%9B%B4%E6%96%B0/image-20220427095916005.png" class="" title="image-20220427095916005">

<p>解密脚本：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x61C88647</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;5^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class="line"> </span><br><span class="line">  <span class="type">void</span> <span class="title function_">btea</span><span class="params">(<span class="type">uint32_t</span> *v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;          <span class="comment">/* Coding Part */</span></span><br><span class="line">      rounds = <span class="number">172</span>;</span><br><span class="line">      sum = <span class="number">0</span>;</span><br><span class="line">      z = v[n<span class="number">-1</span>];</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        sum = (sum - DELTA) &amp; <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (p=<span class="number">0</span>; p&lt;n<span class="number">-1</span>; p++) &#123;</span><br><span class="line">          y = v[p+<span class="number">1</span>];</span><br><span class="line">          z = v[p] += MX;</span><br><span class="line">        &#125;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        z = v[n<span class="number">-1</span>] += MX;</span><br><span class="line">      &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) &#123;  <span class="comment">/* Decoding Part */</span></span><br><span class="line">      n = -n;</span><br><span class="line">      rounds = <span class="number">172</span>;</span><br><span class="line">      sum = (rounds*-DELTA) &amp; <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">      y = v[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (p=n<span class="number">-1</span>; p&gt;<span class="number">0</span>; p--) &#123;</span><br><span class="line">          z = v[p<span class="number">-1</span>];</span><br><span class="line">          y = v[p] -= MX;</span><br><span class="line">        &#125;</span><br><span class="line">        z = v[n<span class="number">-1</span>];</span><br><span class="line">        y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">      &#125; <span class="keyword">while</span> ((sum = (sum+DELTA)&amp;<span class="number">0xFFFFFFFF</span>) != <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>]=&#123;<span class="number">4660</span>,<span class="number">22136</span>,<span class="number">37155</span>,<span class="number">17767</span>&#125;;</span><br><span class="line">    <span class="type">uint32_t</span> data[<span class="number">4</span>]=&#123;<span class="number">1332370953</span>,<span class="number">2931878637</span>,<span class="number">776785408</span>,<span class="number">4020115239</span>&#125;;</span><br><span class="line">    <span class="type">uint32_t</span> *sent=data;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;before:%x  %x  %x  %x\n&quot;</span>,sent[<span class="number">0</span>],sent[<span class="number">1</span>],sent[<span class="number">2</span>],sent[<span class="number">3</span>]);</span><br><span class="line">    btea(sent,<span class="number">-4</span>,key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decoded:%x  %x  %x  %x\n&quot;</span>,sent[<span class="number">0</span>],sent[<span class="number">1</span>],sent[<span class="number">2</span>],sent[<span class="number">3</span>]);</span><br><span class="line">    btea(sent,<span class="number">4</span>,key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;encoded:%x  %x  %x  %x\n&quot;</span>,sent[<span class="number">0</span>],sent[<span class="number">1</span>],sent[<span class="number">2</span>],sent[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="例题2-2022-DefCampCTF-cup-of-tea"><a href="#例题2-2022-DefCampCTF-cup-of-tea" class="headerlink" title="例题2 2022-DefCampCTF-cup_of_tea"></a><a href="https://ke1os.top/2022/02/16/CTF/2022-DefCamp-CTF/#cup-of-tea-xxtea-%E5%B0%8F%E7%AB%AF">例题2 2022-DefCampCTF-cup_of_tea</a></h2><h1 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h1><p>原理<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38130747/article/details/88602061">请查看这里</a></p>
<h2 id="例题1-GUET-CTF2019-encrypt"><a href="#例题1-GUET-CTF2019-encrypt" class="headerlink" title="例题1 GUET-CTF2019-encrypt"></a><a href="https://ke1os.top/2022/01/28/BUU-reverse/BUU-reverse/#GUET-CTF2019-encrypt-RC4-x2F-elf%E5%8A%A8%E8%B0%83-x2F-base64%E5%88%86%E5%9D%97">例题1 GUET-CTF2019-encrypt</a></h2><h2 id="例题2-2021CISCN-glass"><a href="#例题2-2021CISCN-glass" class="headerlink" title="例题2 2021CISCN-glass"></a><a href="https://ke1os.top/2022/04/20/CTF/2021CISCN/#glass">例题2 2021CISCN-glass</a></h2><p>下面给出c实现RC4加密解密代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"></span><br><span class="line">void rc4_init(unsigned char*s,unsigned char*key,unsigned long <span class="built_in">len</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">int</span> j=<span class="number">0</span>;</span><br><span class="line">    unsigned char k[<span class="number">256</span>]=&#123;&#125;;</span><br><span class="line">    unsigned char temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s[i]=i;         //<span class="number">0</span>-<span class="number">255</span>赋给s</span><br><span class="line">        k[i]=key[i%<span class="built_in">len</span>];   //将k重新计算</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        j=(j+s[i]+k[i])%<span class="number">256</span>;    //给j赋值</span><br><span class="line">        temp=s[i];</span><br><span class="line">        s[i]=s[j];</span><br><span class="line">        s[j]=temp;    //s[i]和s[j]交换</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void rc4_crypt(unsigned char*s,unsigned char*data,unsigned long <span class="built_in">len</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>,t=<span class="number">0</span>;</span><br><span class="line">    unsigned long k=<span class="number">0</span>;</span><br><span class="line">    unsigned char temp;</span><br><span class="line">    <span class="keyword">for</span>(k=<span class="number">0</span>;k&lt;<span class="built_in">len</span>;k++)</span><br><span class="line">    &#123;</span><br><span class="line">        i=(i+<span class="number">1</span>)%<span class="number">256</span>;            //固定方式生成的i</span><br><span class="line">        j=(j+s[i])%<span class="number">256</span>;          //固定方式生成的j</span><br><span class="line">        temp=s[i];</span><br><span class="line">        s[i]=s[j];</span><br><span class="line">        s[j]=temp;             //交换s[i]和s[j]</span><br><span class="line">        t=(s[i]+s[j])%<span class="number">256</span>;      //固定方式生成的t</span><br><span class="line">        data[k]^=s[t];          //来作为s的下标和data进行异或运算</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char s[<span class="number">256</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">    char key[<span class="number">256</span>] = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line">    unsigned char data[<span class="number">512</span>]=&#123;<span class="number">0xA3</span>, <span class="number">0x1A</span>, <span class="number">0xE3</span>, <span class="number">0x69</span>, <span class="number">0x2F</span>, <span class="number">0xBB</span>, <span class="number">0x1A</span>, <span class="number">0x84</span>, <span class="number">0x65</span>, <span class="number">0xC2</span>, <span class="number">0xAD</span>, <span class="number">0xAD</span>, <span class="number">0x9E</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x02</span>,<span class="number">0x1F</span>, <span class="number">0x8E</span>, <span class="number">0x36</span>, <span class="number">0x4F</span>, <span class="number">0xE1</span>, <span class="number">0xEB</span>, <span class="number">0xAF</span>, <span class="number">0xF0</span>, <span class="number">0xEA</span>, <span class="number">0xC4</span>, <span class="number">0xA8</span>, <span class="number">0x2D</span>, <span class="number">0x42</span>, <span class="number">0xC7</span>, <span class="number">0x6E</span>, <span class="number">0x3F</span>,<span class="number">0xB0</span>, <span class="number">0xD3</span>, <span class="number">0xCC</span>, <span class="number">0x78</span>, <span class="number">0xF9</span>, <span class="number">0x98</span>, <span class="number">0x3F</span>, <span class="number">0x00</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    unsigned long data_len = <span class="number">39</span>;</span><br><span class="line">    unsigned long key_len = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">39</span>;i+=key_len)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; (key_len &amp; ~(key_len &gt;&gt; <span class="number">31</span>)) != j &amp;&amp; i + j &lt; <span class="number">39</span>; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            data[i+j] = data[i+j] ^ key[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;data_len;i+=<span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        //向右循环回去</span><br><span class="line">        data[i+<span class="number">1</span>] = data[i] ^ data[i+<span class="number">1</span>];</span><br><span class="line">        data[i+<span class="number">2</span>] = data[i+<span class="number">1</span>] ^ data[i+<span class="number">2</span>];</span><br><span class="line">        data[i] = data[i+<span class="number">2</span>] ^ data[i];</span><br><span class="line">    &#125;</span><br><span class="line">    rc4_init(s,(unsigned char*)key,key_len);//初始化得到s</span><br><span class="line">    rc4_crypt(s,(unsigned char*)data,data_len);//解密</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">39</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(<span class="string">&quot;%c&quot;</span>,data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="LCG-线性同余生成器"><a href="#LCG-线性同余生成器" class="headerlink" title="LCG(线性同余生成器)"></a>LCG(线性同余生成器)</h1><p>我们设置增量为b，乘数为a，模数为n，seed随机产生，Si为产生的随机数项数</p>
<p>s0 &#x3D;  (a * seed + b) %  n</p>
<p>s1 &#x3D;  (a * s0 + b) %  n</p>
<p>……</p>
<p>原理实现可以查看<a target="_blank" rel="noopener" href="https://www.codercto.com/a/35743.html">这篇博客</a></p>
<h2 id="ezLCG"><a href="#ezLCG" class="headerlink" title="ezLCG"></a>ezLCG</h2><p>seed是随机产生的，需要输入四个正确的seed值。四个challenge对应四个不同的类型，正好可以用这题来学习一下，解密代码来自Facker007师傅。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Random.random <span class="keyword">import</span> randrange, getrandbits, choice</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed</span>):</span><br><span class="line">        <span class="comment"># 产生一个256位二进制素数</span></span><br><span class="line">        self.N = getPrime(<span class="number">256</span>)</span><br><span class="line">        <span class="comment"># 在N范围内随机产生两个数</span></span><br><span class="line">        self.a = randrange(self.N)</span><br><span class="line">        self.b = randrange(self.N)</span><br><span class="line">        <span class="comment"># seed = seed%N</span></span><br><span class="line">        self.seed = seed % self.N</span><br><span class="line">        self.state = self.seed</span><br><span class="line"></span><br><span class="line">    <span class="comment"># self.state = (a * seed + b)% N</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.state = (self.a * self.state + self.b) % self.N</span><br><span class="line">        <span class="keyword">return</span> self.state</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This is the challenge1&quot;</span>)</span><br><span class="line">    init_seed = getrandbits(<span class="number">256</span>)</span><br><span class="line">    lcg = LCG(init_seed)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.a=&quot;</span>+<span class="built_in">str</span>(lcg.a))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.b=&quot;</span>+<span class="built_in">str</span>(lcg.b))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.N=&quot;</span>+<span class="built_in">str</span>(lcg.N))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num1=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    seed1 = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;lcg.seed = &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> seed1 != lcg.seed:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;worry&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;success!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This is the challenge2&quot;</span>)</span><br><span class="line">    init_seed = getrandbits(<span class="number">256</span>)</span><br><span class="line">    lcg = LCG(init_seed)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.a=&quot;</span>+<span class="built_in">str</span>(lcg.a))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.N=&quot;</span>+<span class="built_in">str</span>(lcg.N))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num1=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    seed1 = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;lcg.seed = &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> seed1 != lcg.seed:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;worry&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;success!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge3</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This is the challenge3&quot;</span>)</span><br><span class="line">    init_seed = getrandbits(<span class="number">256</span>)</span><br><span class="line">    lcg = LCG(init_seed)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.N=&quot;</span>+<span class="built_in">str</span>(lcg.N))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num1=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num3=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    seed1 = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;lcg.seed = &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> seed1 != lcg.seed:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;worry&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;success!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge4</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This is the challenge4&quot;</span>)</span><br><span class="line">    init_seed = getrandbits(<span class="number">256</span>)</span><br><span class="line">    lcg = LCG(init_seed)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num1=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    seed1 = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;lcg.seed = &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> seed1 != lcg.seed:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;worry&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;success!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">challenge1()</span><br><span class="line">challenge2()</span><br><span class="line">challenge3()</span><br><span class="line">challenge4()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;OHHH,give you flag:&quot;</span>+<span class="built_in">str</span>(flag))</span><br></pre></td></tr></table></figure>

<h2 id="1、乘数、增量、模数以及第一项已知"><a href="#1、乘数、增量、模数以及第一项已知" class="headerlink" title="1、乘数、增量、模数以及第一项已知"></a>1、乘数、增量、模数以及第一项已知</h2><p>当我们知道乘数a，增量b模数n，以及第一项s0的值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Random.random <span class="keyword">import</span> randrange, getrandbits, choice</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed</span>):</span><br><span class="line">        <span class="comment"># 产生一个256位二进制素数</span></span><br><span class="line">        self.N = getPrime(<span class="number">256</span>)</span><br><span class="line">        <span class="comment"># 在N范围内随机产生两个数</span></span><br><span class="line">        self.a = randrange(self.N)</span><br><span class="line">        self.b = randrange(self.N)</span><br><span class="line">        <span class="comment"># seed = seed%N</span></span><br><span class="line">        self.seed = seed % self.N</span><br><span class="line">        self.state = self.seed</span><br><span class="line"></span><br><span class="line">    <span class="comment"># self.state = (a * seed + b)% N</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.state = (self.a * self.state + self.b) % self.N</span><br><span class="line">        <span class="keyword">return</span> self.state</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This is the challenge1&quot;</span>)</span><br><span class="line">    init_seed = getrandbits(<span class="number">256</span>)</span><br><span class="line">    lcg = LCG(init_seed)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.a=&quot;</span>+<span class="built_in">str</span>(lcg.a))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.b=&quot;</span>+<span class="built_in">str</span>(lcg.b))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.N=&quot;</span>+<span class="built_in">str</span>(lcg.N))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num1=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    seed1 = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;lcg.seed = &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> seed1 != lcg.seed:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;worry&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;success!&quot;</span>)</span><br><span class="line">    </span><br><span class="line">challenge1()</span><br></pre></td></tr></table></figure>

<p>解密代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">a=<span class="number">11117737577616430261700579904669567704125468079996490555771745492505915194718</span></span><br><span class="line">b=<span class="number">84923302761234043356542012549810957105354826174004592024027163821299864963373</span></span><br><span class="line">n=<span class="number">92990280170239686940570202979208858357118851384588771765813565538598979636449</span></span><br><span class="line">c=<span class="number">75995933492081158742111827152893916938467931731213291787903627350954936992901</span></span><br><span class="line"></span><br><span class="line">MMI = <span class="keyword">lambda</span> A, n,s=<span class="number">1</span>,t=<span class="number">0</span>,N=<span class="number">0</span>: (n &lt; <span class="number">2</span> <span class="keyword">and</span> t%N <span class="keyword">or</span> MMI(n, A%n, t, s-A//n*t, N <span class="keyword">or</span> n),-<span class="number">1</span>)[n&lt;<span class="number">1</span>] <span class="comment">#逆元计算</span></span><br><span class="line">ani=MMI(a,n) </span><br><span class="line">seed=c</span><br><span class="line">seed = (ani*(seed-b))%n</span><br><span class="line"><span class="built_in">print</span>(seed)</span><br></pre></td></tr></table></figure>

<h2 id="2、增量未知"><a href="#2、增量未知" class="headerlink" title="2、增量未知"></a>2、增量未知</h2><p>增量b未知，但是我们指导乘数a，模数n，以及第一项s0和第二项s1的值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">challenge2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This is the challenge2&quot;</span>)</span><br><span class="line">    init_seed = getrandbits(<span class="number">256</span>)</span><br><span class="line">    lcg = LCG(init_seed)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.a=&quot;</span>+<span class="built_in">str</span>(lcg.a))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.N=&quot;</span>+<span class="built_in">str</span>(lcg.N))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num1=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    seed1 = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;lcg.seed = &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> seed1 != lcg.seed:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;worry&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;success!&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s1 = s0 * a + b (mod n)</span><br><span class="line">b = s1 - s0 * a (mod n)</span><br></pre></td></tr></table></figure>

<p>所以先把b求出，在将b带入第一种情况的公式中计算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">60323727461893512389613444053173573556289769830864516385213165273963439419666</span></span><br><span class="line">n=<span class="number">63772765535116504991324866664138155127506417671814317141463381824201626745971</span></span><br><span class="line">output1=<span class="number">43256779548950618105205057172060658758096778650647953356786682933134845983013</span></span><br><span class="line">output2=<span class="number">29587660751402347472955722163351167446529078992073715521709478134706039994408</span></span><br><span class="line">b=(output2-a*output1)%n</span><br><span class="line">plaintext=b</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line">MMI = <span class="keyword">lambda</span> A, n,s=<span class="number">1</span>,t=<span class="number">0</span>,N=<span class="number">0</span>: (n &lt; <span class="number">2</span> <span class="keyword">and</span> t%N <span class="keyword">or</span> MMI(n, A%n, t, s-A//n*t, N <span class="keyword">or</span> n),-<span class="number">1</span>)[n&lt;<span class="number">1</span>] <span class="comment">#逆元计算</span></span><br><span class="line">ani=MMI(a,n) </span><br><span class="line">seed=output1</span><br><span class="line">seed = (ani*(seed-b))%n</span><br><span class="line"><span class="built_in">print</span>(seed)</span><br></pre></td></tr></table></figure>

<h2 id="3、增量和乘数都未知"><a href="#3、增量和乘数都未知" class="headerlink" title="3、增量和乘数都未知"></a>3、增量和乘数都未知</h2><p>不知道增量、乘数，但是我们知道模数和生成的三个项</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">challenge3</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This is the challenge3&quot;</span>)</span><br><span class="line">    init_seed = getrandbits(<span class="number">256</span>)</span><br><span class="line">    lcg = LCG(init_seed)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.N=&quot;</span>+<span class="built_in">str</span>(lcg.N))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num1=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num3=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    seed1 = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;lcg.seed = &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> seed1 != lcg.seed:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;worry&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;success!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>通过推导，我们能够得出m和第一项s0和s1的关系，进而求出乘数a</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s_1 = s0 * a + c (mod n)</span><br><span class="line"></span><br><span class="line">s_2 = s1 * a + c (mod n) </span><br><span class="line"></span><br><span class="line">s_2 - s_1 = s1 * a - s0 * a (mod n) </span><br><span class="line"></span><br><span class="line">s_2 - s_1 = a * (s1 - s0) (mod n) </span><br><span class="line"></span><br><span class="line">a = (s_2 - s_1) / (s_1 - s_0) (mod n)</span><br></pre></td></tr></table></figure>

<p>解密代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">n=<span class="number">104461692199190870384162670916383905806504699111028506483787017106937648022643</span></span><br><span class="line">output=[<span class="number">6550230559976097543274928060228453869006546100488341839360547865795937436891</span>,<span class="number">44752667588957927743657454733563259587297714640962541054244442038265293238724</span>,<span class="number">89196637577760609199681073855370265788123333887828297191613180231566862499303</span>]</span><br><span class="line"></span><br><span class="line">MMI = <span class="keyword">lambda</span> A, n,s=<span class="number">1</span>,t=<span class="number">0</span>,N=<span class="number">0</span>: (n &lt; <span class="number">2</span> <span class="keyword">and</span> t%N <span class="keyword">or</span> MMI(n, A%n, t, s-A//n*t, N <span class="keyword">or</span> n),-<span class="number">1</span>)[n&lt;<span class="number">1</span>] <span class="comment">#逆元计算</span></span><br><span class="line">a=(output[<span class="number">2</span>]-output[<span class="number">1</span>])*MMI((output[<span class="number">1</span>]-output[<span class="number">0</span>]),n)%n</span><br><span class="line">ani=MMI(a,n)</span><br><span class="line">b=(output[<span class="number">1</span>]-a*output[<span class="number">0</span>])%n</span><br><span class="line">seed = (ani*(output[<span class="number">0</span>]-b))%n</span><br><span class="line"><span class="built_in">print</span>(seed)</span><br></pre></td></tr></table></figure>

<h2 id="4-增量，乘数和模数均未知"><a href="#4-增量，乘数和模数均未知" class="headerlink" title="4.增量，乘数和模数均未知"></a>4.增量，乘数和模数均未知</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">challenge4</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This is the challenge4&quot;</span>)</span><br><span class="line">    init_seed = getrandbits(<span class="number">256</span>)</span><br><span class="line">    lcg = LCG(init_seed)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num1=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lcg.num2=&quot;</span>+<span class="built_in">str</span>(lcg.<span class="built_in">next</span>()))</span><br><span class="line">    seed1 = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;lcg.seed = &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> seed1 != lcg.seed:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;worry&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;success!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>通过以上的条件，我们可以得知</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s1 = s0*a + b  (mod n)</span><br><span class="line">s2 = s1*a + b  (mod n)</span><br><span class="line">s3 = s2*a + b  (mod n)</span><br><span class="line">s1 - (s0*a + b) = k_1 * n</span><br><span class="line">s2 - (s1*a + b) = k_2 * n</span><br><span class="line">s3 - (s2*a + b) = k_3 * n</span><br></pre></td></tr></table></figure>

<img src="/2022/04/27/%E7%AE%97%E6%B3%95/CTF%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93-%E6%9B%B4%E6%96%B0/image-20220427111500647.png" class="" title="image-20220427111500647">



<img src="/2022/04/27/%E7%AE%97%E6%B3%95/CTF%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93-%E6%9B%B4%E6%96%B0/image-20220427111809241.png" class="" title="image-20220427111809241">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">t0 = s1 - s0 </span><br><span class="line">t1 = s2 - s1 = (s1*a + b) - (s0*a + b) = a*(s1 - s0) = a*t0 (mod n) </span><br><span class="line">t2 = s3 - s2 = (s2*a + b) - (s1*a + b) = a*(s2 - s1) = a*t1 (mod n) </span><br><span class="line">t3 = s4 - s3 = (s3*a + b) - (s2*a + b) = a*(s3 - s2) = a*t2 (mod n)</span><br><span class="line"></span><br><span class="line">t2*t0 - t1*t1 = (a*a*t0 * t0) - (a*t0 * a*t0) = <span class="number">0</span> (mod n)</span><br></pre></td></tr></table></figure>

<p>这样我们就能得知模数的值了，然后和上面的步骤一样，首先是求出乘数a，再求出增量b，最后求出seed</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">a,b</span>): </span><br><span class="line">    <span class="keyword">if</span>(b==<span class="number">0</span>): </span><br><span class="line">        <span class="keyword">return</span> a </span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> gcd(b,a%b) </span><br><span class="line">s=[<span class="number">57910593547760246431462713630032142367244471051605076587740229220042280832920</span>,<span class="number">11600425056943962908662902750683336131127946274679975994830394345407157891082</span>,<span class="number">47119365134041787030301982910979871560470568882978296406276875902026809579279</span>,<span class="number">25490059061411916076337727920693205583062663924577215773084273265684255685447</span>,<span class="number">47700923797846895333737702397666052553146427650812068867781925243881523549580</span>,<span class="number">16494559622316759559052404259689488233512192201762700665909062412108972353608</span>]</span><br><span class="line">t = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    t.append(s[i]-s[i-<span class="number">1</span>]) </span><br><span class="line">all_n = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    all_n.append(gcd((t[i+<span class="number">1</span>]*t[i-<span class="number">1</span>]-t[i]*t[i]), (t[i+<span class="number">2</span>]*t[i]-t[i+<span class="number">1</span>]*t[i+<span class="number">1</span>]))) </span><br><span class="line"></span><br><span class="line">MMI = <span class="keyword">lambda</span> A, n,s=<span class="number">1</span>,t=<span class="number">0</span>,N=<span class="number">0</span>: (n &lt; <span class="number">2</span> <span class="keyword">and</span> t%N <span class="keyword">or</span> MMI(n, A%n, t, s-A//n*t, N <span class="keyword">or</span> n),-<span class="number">1</span>)[n&lt;<span class="number">1</span>] <span class="comment">#逆元计算</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> all_n:</span><br><span class="line">    n=<span class="built_in">abs</span>(n)</span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    a=(s[<span class="number">2</span>]-s[<span class="number">1</span>])*MMI((s[<span class="number">1</span>]-s[<span class="number">0</span>]),n)%n</span><br><span class="line">    ani=MMI(a,n)</span><br><span class="line">    b=(s[<span class="number">1</span>]-a*s[<span class="number">0</span>])%n</span><br><span class="line">    seed = (ani*(s[<span class="number">0</span>]-b))%n</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;seed=&quot;</span>,seed)</span><br><span class="line">    plaintext=seed</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(plaintext))</span><br></pre></td></tr></table></figure>

<h1 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h1><p>当然也有RSA，详细查看我的<a href="https://ke1os.top/2022/03/22/BUU_crypto/rsa%E5%90%88%E9%9B%86/">另一篇博客</a></p>
<h1 id="ECC"><a href="#ECC" class="headerlink" title="ECC"></a>ECC</h1><p>记录一下XCTF中的一道关于ECC的题目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">已知椭圆曲线加密Ep(a,b)参数为</span><br><span class="line"></span><br><span class="line">p = <span class="number">15424654874903</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">16546484</span></span><br><span class="line"></span><br><span class="line">b = <span class="number">4548674875</span></span><br><span class="line"></span><br><span class="line">G(<span class="number">6478678675</span>,<span class="number">5636379357093</span>)</span><br><span class="line"></span><br><span class="line">私钥为</span><br><span class="line"></span><br><span class="line">k = <span class="number">546768</span></span><br><span class="line"></span><br><span class="line">求公钥K(x,y)</span><br></pre></td></tr></table></figure>

<p>这边使用ECCTOOL来解</p>
<img src="/2022/04/27/%E7%AE%97%E6%B3%95/CTF%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93-%E6%9B%B4%E6%96%B0/image-20220515155416131.png" class="" title="image-20220515155416131">

<p>Rx  &#x3D; 13957031351290</p>
<p>Ry &#x3D; 5520194834100</p>
<p>Rx + Ry &#x3D; 19477226185390</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-04-27</span><i class="fa fa-tag"></i><a class="tag" href="/tags/常见加密算法/" title="常见加密算法">常见加密算法 </a><span class="leancloud_visitors"></span><span>About 2533 words, 8 min 26 sec  read</span></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/page/2/">Next</a></li></ul></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>