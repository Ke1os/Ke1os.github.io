<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="ke1os"><title>2022_DefCamp_CTF · ke1os' blog</title><meta name="description" content="复现一下2022DefCampCTF


Reversecup_of_tea (xxtea+小端)python实现tea&amp;#x2F;xtea&amp;#x2F;xxtea算法传送门：https://qianfei11.github.io/2019/08/22/Python%E5%AE%9E%E7%8E%B0"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/ke1os.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.1.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"><img src="/images/ke1os.png"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/ke1os.png" style="width:220px;" alt="favicon"><h3 title=""><a href="/">ke1os' blog</a></h3><div class="description"><p>“每一个不曾起舞的日子,都是对生命的辜负。”</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/ke1os"><i class="fa fa-github"></i></a></li><li><a href="mailto:3131697620@qq.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY=3131697620"><i class="fa fa-qq"></i></a></li></ul></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> ke1os</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><span>Anatolo </span></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>2022_DefCamp_CTF</a></h3></div><div class="post-content"><p><p>复现一下2022DefCampCTF</p>
<span id="more"></span>

<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="cup-of-tea-xxtea-小端"><a href="#cup-of-tea-xxtea-小端" class="headerlink" title="cup_of_tea (xxtea+小端)"></a>cup_of_tea (xxtea+小端)</h2><p>python实现tea&#x2F;xtea&#x2F;xxtea算法传送门：<a target="_blank" rel="noopener" href="https://qianfei11.github.io/2019/08/22/Python%E5%AE%9E%E7%8E%B0TEA%E3%80%81XTEA%E3%80%81XXTEA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95/">https://qianfei11.github.io/2019/08/22/Python%E5%AE%9E%E7%8E%B0TEA%E3%80%81XTEA%E3%80%81XXTEA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95/</a></p>
<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220216201657660.png" class="" title="image-20220216201657660">

<p>v7字符串经过加密之后是运行后的C7……字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">We are under attack.</span><br><span class="line">We need a group of hacker to decrypt this weird message.</span><br><span class="line">And Betaflash <span class="keyword">is</span> <span class="keyword">not</span> slow :)).</span><br><span class="line">Decrypt me <span class="keyword">if</span> you can: C7E4C81E20EBFB67A4977BA91C9C312FFF81669CA85798D475F0D9081DF7017CC8D009ADF02F67DD41D1F781EF56F8EA2225502AF957D6844084CEE3BB7D2350DBF05DCD8B0AD33CD52C5E0171E4</span><br></pre></td></tr></table></figure>

<p>我们需要做的是通过上面的加密去寻找解密方法，然后把下面的字符串破译出来</p>
<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220216202242957.png" class="" title="image-20220216202242957">

<p>ida查看一下：</p>
<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220216202424996.png" class="" title="image-20220216202424996">

<p>encrypt函数看了一眼是tea类的加密，sprintf，发送格式化输出到v13字符串，%02x，两位十六进制数，左侧补零。</p>
<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220216213527523.png" class="" title="image-20220216213527523">

<p>放C里面调试了一下……</p>
<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220216202722716.png" class="" title="image-20220216202722716">

<p>这边就是主要的算法了。</p>
<p>在网上找了一段有关xxtea加密解密的python2版本的代码，然后转成了python3的格式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">shift</span>(<span class="params">z, y, x, k, p, e</span>):</span><br><span class="line">    <span class="keyword">return</span> ((((z &gt;&gt; <span class="number">5</span>) ^ (y &lt;&lt; <span class="number">2</span>)) + ((y &gt;&gt; <span class="number">3</span>) ^ (z &lt;&lt; <span class="number">4</span>))) ^ ((x ^ y) + (k[(p &amp; <span class="number">3</span>) ^ e] ^ z)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    n = <span class="built_in">len</span>(v)</span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span> / n</span><br><span class="line">    x = (<span class="built_in">int</span>(rounds) * delta) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">    y = v[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(rounds)):</span><br><span class="line">        e = (x &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            z = v[p - <span class="number">1</span>]</span><br><span class="line">            v[p] = (v[p] - shift(z, y, x, k, p, e)) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">            y = v[p]</span><br><span class="line">        p -= <span class="number">1</span></span><br><span class="line">        z = v[n - <span class="number">1</span>]</span><br><span class="line">        v[<span class="number">0</span>] = (v[<span class="number">0</span>] - shift(z, y, x, k, p, e)) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">        y = v[<span class="number">0</span>]</span><br><span class="line">        x = (x - delta) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    n = <span class="built_in">len</span>(v)</span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span> / n</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    z = v[n - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(rounds)):</span><br><span class="line">        x = (x + delta) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">        e = (x &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>):</span><br><span class="line">            y = v[p + <span class="number">1</span>]</span><br><span class="line">            v[p] = (v[p] + shift(z, y, x, k, p, e)) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">            z = v[p]</span><br><span class="line">        p += <span class="number">1</span></span><br><span class="line">        y = v[<span class="number">0</span>]</span><br><span class="line">        v[n - <span class="number">1</span>] = (v[n - <span class="number">1</span>] + shift(z, y, x, k, p, e)) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">        z = v[n - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    plain = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    key = [<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">    encrypted = encrypt(plain, key)</span><br><span class="line">    <span class="built_in">print</span> (encrypted)</span><br><span class="line">    decrypted = decrypt(encrypted, key)</span><br><span class="line">    <span class="built_in">print</span> (decrypted)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关键部分做了替换。其中，最为重要的是，题目给出的字符串因为小端模式需要转换</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">encrypted  = [<span class="number">0x68E399CC4DAEA4D0</span>,<span class="number">0x81b8676d9966bdba</span>,<span class="number">0x78adb022d0e2ab59</span>,<span class="number">0xf31ce8b16e9ad6f1</span>,<span class="number">0xd6054099FE3E9B58</span>,<span class="number">0xB7443CFDB29DDEA9</span>,<span class="number">0x2922AC6A31D22876</span>,<span class="number">0x2022E42B93EC38E9</span>,<span class="number">0x0A825546911D6DDD</span>,<span class="number">0x8D3A9936229EC043</span>]</span><br><span class="line">key = [<span class="number">73</span>,<span class="number">32</span>,<span class="number">108</span>,<span class="number">111</span>,<span class="number">118</span>,<span class="number">101</span>,<span class="number">32</span>,<span class="number">112</span>,<span class="number">97</span>,<span class="number">110</span>,<span class="number">99</span>,<span class="number">97</span>,<span class="number">107</span>,<span class="number">101</span>,<span class="number">115</span>]</span><br></pre></td></tr></table></figure>

<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220217003336694.png" class="" title="image-20220217003336694">

<p>注意这边的6+52&#x2F;n换成了6+52&#x2F;10</p>
<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220216235153803.png" class="" title="image-20220216235153803">

<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220216235652279.png" class="" title="image-20220216235652279">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">6859953592044237650</span>, <span class="number">5070864542475440945</span>, <span class="number">6436263400528900656</span>, <span class="number">3370575</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>然后将所得的列表，转换成16进制，按每两位一组，拼接成flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string = <span class="string">&#x27;5f33737245763352465f546f4e5f533159523376455f7230336e4f&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = [<span class="number">0x5f</span>,<span class="number">0x33</span>,<span class="number">0x73</span>,<span class="number">0x72</span>,<span class="number">0x45</span>,<span class="number">0x76</span>,<span class="number">0x33</span>,<span class="number">0x52</span>,<span class="number">0x46</span>,<span class="number">0x5f</span>,<span class="number">0x54</span>,<span class="number">0x6f</span>,\</span><br><span class="line"><span class="number">0x4e</span>,<span class="number">0x5f</span>,<span class="number">0x53</span>,<span class="number">0x31</span>,<span class="number">0x59</span>,<span class="number">0x52</span>,<span class="number">0x33</span>,<span class="number">0x6e</span>,<span class="number">0x4f</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">	flag+=<span class="built_in">chr</span>(x[i])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>_3srEv3RF_ToN_S1YR3nO</p>
<p>CTF{3e6a586b00305bc4e74243c66d91525a}</p>
<h2 id="algorithm-dfs-plus-暴破-plus"><a href="#algorithm-dfs-plus-暴破-plus" class="headerlink" title="algorithm (dfs plus+暴破 plus)"></a>algorithm (dfs plus+暴破 plus)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&#x27; [test]&#x27;</span></span><br><span class="line">hflag = flag.encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">iflag = <span class="built_in">int</span>(hflag[<span class="number">2</span>:], <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">polinom</span>(<span class="params">n, m</span>):</span><br><span class="line">   i = <span class="number">0</span></span><br><span class="line">   z = []</span><br><span class="line">   s = <span class="number">0</span></span><br><span class="line">   <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">      <span class="keyword">if</span> n % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">         z.append(<span class="number">2</span> - (n % <span class="number">4</span>))</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">         z.append(<span class="number">0</span>)</span><br><span class="line">      n = (n - z[i])/<span class="number">2</span></span><br><span class="line">      i = i + <span class="number">1</span></span><br><span class="line">   z = z[::-<span class="number">1</span>]</span><br><span class="line">   l = <span class="built_in">len</span>(z)</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, l):</span><br><span class="line">       s += z[i] * m ** (l - <span class="number">1</span> - i)</span><br><span class="line">   <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">r = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="built_in">len</span>(<span class="built_in">str</span>(iflag)):</span><br><span class="line">   d = <span class="built_in">str</span>(iflag)[i:i+<span class="number">2</span>]</span><br><span class="line">   nf = polinom(<span class="built_in">int</span>(d), <span class="number">3</span>)</span><br><span class="line">   r += <span class="built_in">str</span>(nf)</span><br><span class="line">   i += <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> r </span><br></pre></td></tr></table></figure>

<p>放linux运行了一下，仔细分析之后，得出正向加密的步骤：</p>
<ol>
<li><p>将flag字符串中每一个字符都转换为16进制数拼凑起来的数,赋值给hflag，</p>
</li>
<li><p>将hflag开头两位去除后转换的10进制数，赋值为iflag。</p>
</li>
<li><p>依次iflag每两位拆分为n，将n和3分别作为一参和二参放入polinom中进行加密：将n通过while循环根据奇偶转换为z表，对z表中的每个元素*m^i后累加为s，返回值为s。</p>
</li>
<li><p>加密结束后，把最后的结果赋值给nf，转换成str，拼在一起就是加密后的字符。</p>
</li>
</ol>
<p>本人用 “ [hello]”进行了模拟运算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">polinom</span>(<span class="params">n, m</span>):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    z = []</span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            z.append(<span class="number">2</span> - (n % <span class="number">4</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            z.append(<span class="number">0</span>)</span><br><span class="line">        n = (n - z[i])/<span class="number">2</span></span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;z:&quot;</span>,</span><br><span class="line">    <span class="built_in">print</span> (z)</span><br><span class="line">    l = <span class="built_in">len</span>(z)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, l):</span><br><span class="line">        s += z[i] * m ** i</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27; [hello]&#x27;</span></span><br><span class="line">hflag = flag.encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(hflag)</span><br><span class="line">iflag = <span class="built_in">int</span>(hflag[<span class="number">2</span>:],<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(iflag)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">r = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="built_in">len</span>(<span class="built_in">str</span>(iflag)):</span><br><span class="line">    d = (<span class="built_in">str</span>(iflag)[i:i+<span class="number">2</span>])</span><br><span class="line">    <span class="built_in">print</span>(d)</span><br><span class="line">    nf = polinom(<span class="built_in">int</span>(d),<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;nf:&quot;</span>,</span><br><span class="line">    <span class="built_in">print</span>(nf)</span><br><span class="line">    r += <span class="built_in">str</span>(nf)</span><br><span class="line">    i += <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure>

<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220217161509081.png" class="" title="image-20220217161509081">

<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220217160705339.png" class="" title="image-20220217160705339">



<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220217172203401.png" class="" title="image-20220217172203401">

<p>若m为99(最大的两位数)，while循环后，累加出来的s为1952，所以两位数最多可以被加密成4位数（见以上步骤3）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">polinom</span>(<span class="params">n, m</span>):</span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	z = []</span><br><span class="line">	s = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">if</span> n % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">			z.append(<span class="number">2</span> - (n % <span class="number">4</span>))</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			z.append(<span class="number">0</span>)</span><br><span class="line">		n = (n - z[i]) // <span class="number">2</span></span><br><span class="line">		i = i + <span class="number">1</span></span><br><span class="line">	z = z[::-<span class="number">1</span>]</span><br><span class="line">	l = <span class="built_in">len</span>(z)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, l):</span><br><span class="line">		s += z[i] * m**(l - <span class="number">1</span> - i)</span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_b</span>(<span class="params">b</span>): </span><br><span class="line">	s = <span class="built_in">str</span>(b[<span class="number">0</span>])</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> b[<span class="number">1</span>:-<span class="number">1</span>]:</span><br><span class="line">		<span class="keyword">if</span> i &lt; <span class="number">10</span>:</span><br><span class="line">			s = s + <span class="string">&quot;0&quot;</span> + <span class="built_in">str</span>(i)</span><br><span class="line">			<span class="built_in">print</span>(s)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			s = s + <span class="built_in">str</span>(i)</span><br><span class="line">	res = s + <span class="built_in">str</span>(b[-<span class="number">1</span>])</span><br><span class="line">	<span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">b = []</span><br><span class="line">a = <span class="string">&#x27;242712673639869973827786401934639193473972235217215301&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">n</span>):</span><br><span class="line">	<span class="keyword">global</span> b</span><br><span class="line">	<span class="keyword">if</span> (n &gt; <span class="built_in">len</span>(a)):</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">if</span> (n == <span class="built_in">len</span>(a)):</span><br><span class="line">		m = print_b(b)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">		s = a[n:n + i]     </span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">			<span class="keyword">if</span> (polinom(j, <span class="number">3</span>) == <span class="built_in">int</span>(s)):</span><br><span class="line">				b.append(j)</span><br><span class="line">				dfs(n + i)</span><br><span class="line">				b.pop()</span><br><span class="line"></span><br><span class="line">dfs(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>通过dfs和爆破，求出了列表b，其应当为加密函数polinom(n, m) 返回值s组成的列表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">31</span>, <span class="number">11</span>, <span class="number">38</span>, <span class="number">2</span>, <span class="number">44</span>, <span class="number">3</span>, <span class="number">54</span>, <span class="number">68</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">45</span>, <span class="number">91</span>, <span class="number">44</span>, <span class="number">91</span>, <span class="number">69</span>, <span class="number">12</span>, <span class="number">29</span>, <span class="number">25</span>, <span class="number">23</span>, <span class="number">10</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<p>然后通过print_b的填零操作，将列表b转换成iflag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">31113802440354680814459144916912292523101</span></span><br></pre></td></tr></table></figure>

<p>注意，b列表的最后一位不需要在前面加上“0”，</p>
<p>最后通过long_to_bytes将iflag转换为flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">polinom</span>(<span class="params">n, m</span>):</span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	z = []</span><br><span class="line">	s = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">if</span> n % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">			z.append(<span class="number">2</span> - (n % <span class="number">4</span>))</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			z.append(<span class="number">0</span>)</span><br><span class="line">		n = (n - z[i]) // <span class="number">2</span></span><br><span class="line">		i = i + <span class="number">1</span></span><br><span class="line">	z = z[::-<span class="number">1</span>]</span><br><span class="line">	l = <span class="built_in">len</span>(z)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, l):</span><br><span class="line">		s += z[i] * m**(l - <span class="number">1</span> - i)</span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_b</span>(<span class="params">b</span>): </span><br><span class="line">	s = <span class="built_in">str</span>(b[<span class="number">0</span>])</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> b[<span class="number">1</span>:-<span class="number">1</span>]:</span><br><span class="line">		<span class="keyword">if</span> i &lt; <span class="number">10</span>:</span><br><span class="line">			s = s + <span class="string">&quot;0&quot;</span> + <span class="built_in">str</span>(i)</span><br><span class="line">			<span class="built_in">print</span>(s)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			s = s + <span class="built_in">str</span>(i)</span><br><span class="line">	res = s + <span class="built_in">str</span>(b[-<span class="number">1</span>])</span><br><span class="line">	<span class="built_in">print</span>(res)	<span class="comment">#将还原出的b列表转换为一个十进制数</span></span><br><span class="line"></span><br><span class="line">b = []</span><br><span class="line">a = <span class="string">&#x27;242712673639869973827786401934639193473972235217215301&#x27;</span></span><br><span class="line"><span class="comment">#通过dfs和循环将拼接的 nf 还原出来</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">n</span>):</span><br><span class="line">	<span class="keyword">global</span> b</span><br><span class="line">	<span class="keyword">if</span> (n &gt; <span class="built_in">len</span>(a)):</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">if</span> (n == <span class="built_in">len</span>(a)):</span><br><span class="line">		m = print_b(b)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">		s = a[n:n + i]     </span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">			<span class="keyword">if</span> (polinom(j, <span class="number">3</span>) == <span class="built_in">int</span>(s)):</span><br><span class="line">				b.append(j)</span><br><span class="line">				dfs(n + i)</span><br><span class="line">				b.pop()</span><br><span class="line">			</span><br><span class="line">dfs(<span class="number">0</span>)</span><br><span class="line">nf=[<span class="number">31</span>, <span class="number">11</span>, <span class="number">38</span>, <span class="number">2</span>, <span class="number">44</span>, <span class="number">3</span>, <span class="number">54</span>, <span class="number">68</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">45</span>, <span class="number">91</span>, <span class="number">44</span>, <span class="number">91</span>, <span class="number">69</span>, <span class="number">12</span>, <span class="number">29</span>, <span class="number">25</span>, <span class="number">23</span>, <span class="number">10</span>, <span class="number">1</span>]</span><br><span class="line">iflag = <span class="number">31113802440354680814459144916912292523101</span></span><br><span class="line">flag = long_to_bytes(iflag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>关于python Crypto.util 模块的byte_to_long和long_to_bytes的使用：</p>
<img src="/2022/02/16/CTF/2022-DefCamp-CTF/image-20220217152257046.png" class="" title="image-20220217152257046">

<p>[ola_th1s_1s_p0l]</p>
</p></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-02-16</span><i class="fa fa-tag"></i><a class="tag" href="/tags/CTF赛后复现/" title="CTF赛后复现">CTF赛后复现 </a><span class="leancloud_visitors"></span><span>About 1506 words, 5 min 1 sec  read</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://ke1os.top/2022/02/16/CTF/2022-DefCamp-CTF/,ke1os' blog,2022_DefCamp_CTF,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2022/03/01/BUU_crypto/BUU-crypto/" title="BUU-crypto">Previous</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2022/02/14/CTF/2022V&amp;NCTF/" title="2022V&amp;NCTF--赛后复现">Next</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>